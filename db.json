{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/img/ironman-draw.png","path":"img/ironman-draw.png","modified":0,"renderable":0},{"_id":"source/img/header_img/lf.jpg","path":"img/header_img/lf.jpg","modified":0,"renderable":0},{"_id":"source/img/header_img/top.jpg","path":"img/header_img/top.jpg","modified":0,"renderable":0},{"_id":"themes/beantech/source/css/archive.styl","path":"css/archive.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/beantech.css","path":"css/beantech.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/highlight.styl","path":"css/highlight.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/beantech.min.css","path":"css/beantech.min.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/rocket.styl","path":"css/rocket.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/hux-blog.min.css","path":"css/hux-blog.min.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/signature.styl","path":"css/signature.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/toc.styl","path":"css/toc.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/widget.styl","path":"css/widget.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.eot","path":"fonts/glyphicons-halflings-regular.eot","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.ttf","path":"fonts/glyphicons-halflings-regular.ttf","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff2","path":"fonts/glyphicons-halflings-regular.woff2","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/hux-blog.min.js","path":"js/hux-blog.min.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/bootstrap.min.js","path":"js/bootstrap.min.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/hux-blog.js","path":"js/hux-blog.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/jquery.nav.js","path":"js/jquery.nav.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/toc.js","path":"js/toc.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/jquery.tagcloud.js","path":"js/jquery.tagcloud.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff","path":"fonts/glyphicons-halflings-regular.woff","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/bootstrap.min.css","path":"css/bootstrap.min.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.svg","path":"fonts/glyphicons-halflings-regular.svg","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/bootstrap.js","path":"js/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/images/ironman.png","path":"css/images/ironman.png","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/images/rocket.png","path":"css/images/rocket.png","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/bootstrap.css","path":"css/bootstrap.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/images/top.jpg","path":"css/images/top.jpg","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/jquery.js","path":"js/jquery.js","modified":0,"renderable":1},{"_id":"source/img/header_img/7vLMRNQ.jpg","path":"img/header_img/7vLMRNQ.jpg","modified":0,"renderable":0}],"Cache":[{"_id":"source/404.md","hash":"83c2c6d587beaa967a976e5969d60fa97fcdbe55","modified":1541833242421},{"_id":"source/CNAME","hash":"55d5b0b4757a7d65ee4966dd161f394d06d257b7","modified":1541833242421},{"_id":"themes/beantech/_config.yml","hash":"6afd65c055d9b1c70ae67323cc869f1b4aa60348","modified":1541833242477},{"_id":"themes/beantech/LICENSE","hash":"2b209f06bebeb2a8c2b7e187e436f3e1e1fbc8a7","modified":1541833242476},{"_id":"source/about/index.md","hash":"183cc8293f91608794169a65740502ef78738439","modified":1541840933541},{"_id":"source/_posts/python学习笔记（一）.md","hash":"86fb5a30aa2fe9ece35d407fe67f1fffd38114df","modified":1542642070352},{"_id":"source/_posts/crd.md","hash":"fc1bf9f0f6ef06b993bf3295f7a1a92a206b5c5d","modified":1542029561585},{"_id":"source/_posts/deployment.md","hash":"cd77fd4e9431d371f7896d5b8b5ea8c3cf8a76df","modified":1541837065527},{"_id":"source/_posts/hiadmin.md","hash":"5377f96ed665fcef29980532d3a8c0c98e5cf7a7","modified":1542100899702},{"_id":"source/archive/index.md","hash":"279ff19668395f5c6b26417da99d2c1f3ecd5886","modified":1541833242431},{"_id":"source/tags/index.md","hash":"a1d4601d5ca7f5a621071e102872e7fc865da657","modified":1541837157124},{"_id":"source/img/ironman-draw.png","hash":"431a3e029ea1c381279477bd1d2d2ae4d61d9722","modified":1484236904000},{"_id":"themes/beantech/languages_to_be_added/de.yml","hash":"424a9c1e6ab69334d7873f6574da02ca960aa572","modified":1541833242477},{"_id":"themes/beantech/languages_to_be_added/default.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1541833242477},{"_id":"themes/beantech/languages_to_be_added/en.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1541833242477},{"_id":"themes/beantech/languages_to_be_added/es.yml","hash":"cb4eeca0ed3768a77e0cd216300f2b2549628b1b","modified":1541833242478},{"_id":"themes/beantech/languages_to_be_added/no.yml","hash":"8ca475a3b4f8efe6603030f0013aae39668230e1","modified":1541833242478},{"_id":"themes/beantech/languages_to_be_added/pl.yml","hash":"de7eb5850ae65ba7638e907c805fea90617a988c","modified":1541833242478},{"_id":"themes/beantech/languages_to_be_added/ru.yml","hash":"42df7afeb7a35dc46d272b7f4fb880a9d9ebcaa5","modified":1541833242478},{"_id":"themes/beantech/languages_to_be_added/zh-CN.yml","hash":"7bfcb0b8e97d7e5edcfca8ab26d55d9da2573c1c","modified":1541833242478},{"_id":"themes/beantech/languages_to_be_added/zh-TW.yml","hash":"9acac6cc4f8002c3fa53ff69fb8cf66c915bd016","modified":1541833242479},{"_id":"themes/beantech/layout/about.ejs","hash":"edcf8fa3bf7093c974d418ffef42ac89c19af128","modified":1541833242482},{"_id":"themes/beantech/layout/404.ejs","hash":"a4d73541a53e56b7dd46249c6d27cb59f4d97422","modified":1541833242479},{"_id":"themes/beantech/layout/index.ejs","hash":"dc8a6eaa00d1e7c33a40979afe0953ed5d7b512e","modified":1541833242482},{"_id":"themes/beantech/layout/archive.ejs","hash":"72a150c8dff0031a9107d12eaa7c2e6c6ce950d2","modified":1541833242482},{"_id":"themes/beantech/layout/keynote.ejs","hash":"f5689862281e34dbe8402b0e72f632902e53e88b","modified":1541833242482},{"_id":"themes/beantech/layout/tags.ejs","hash":"2c72eb2e89130658aa068d80d27b561b509c5dcd","modified":1541833242483},{"_id":"themes/beantech/layout/layout.ejs","hash":"a5af5b99ac3456ab5da1a319455904b979b91601","modified":1541833242483},{"_id":"themes/beantech/layout/page.ejs","hash":"c90797e4394c5cb63c2515109480e766d04e486e","modified":1541833242483},{"_id":"themes/beantech/layout/post.ejs","hash":"2d55684fc539dc281f9e2ec0409f09ea6ca43949","modified":1541833242483},{"_id":"source/img/header_img/lf.jpg","hash":"ca95289c809aab7897f7f3509604cc2b62833717","modified":1541840086000},{"_id":"source/img/header_img/top.jpg","hash":"1e6e20be3609d58e050c64d3803206c75dd050bd","modified":1541837913609},{"_id":"themes/beantech/layout/_partial/head.ejs","hash":"2b70bba84d5beda85a59700f7f31ed529b1d2542","modified":1541839698860},{"_id":"themes/beantech/layout/_partial/footer.ejs","hash":"c31863b1fa66fd915bc4913440be6c610d12af80","modified":1541833242479},{"_id":"themes/beantech/layout/_partial/header.ejs","hash":"aafb744601042f0270d2e6595129ac8a73ad2608","modified":1541833242480},{"_id":"themes/beantech/layout/_partial/nav.ejs","hash":"4c905166c960852e9b9a3c9d5c680091e37b481f","modified":1541833242480},{"_id":"themes/beantech/layout/_partial/pagination.ejs","hash":"557d6bb069a1d48af49ae912994653f44b32a570","modified":1541833242480},{"_id":"themes/beantech/layout/_partial/sidebar.ejs","hash":"2e4e528a555917b2a267da4db2440bcc4a7a65ab","modified":1541833242480},{"_id":"themes/beantech/layout/_widget/archive.ejs","hash":"7594929d472806ca4c64d9906d9903a96de111a0","modified":1541833242481},{"_id":"themes/beantech/layout/_partial/toc.ejs","hash":"837f01e8a20e5023b4b292d1b3141a399567da65","modified":1541833242480},{"_id":"themes/beantech/layout/_widget/category.ejs","hash":"1cf485def07dc06e870dc9613767c6c614bcf428","modified":1541833242481},{"_id":"themes/beantech/layout/_widget/friends-blog.ejs","hash":"734d3775017aedac185028924baf890a71a74548","modified":1541833242481},{"_id":"themes/beantech/layout/_widget/featured-tags.ejs","hash":"0c9ce1942f1943dc8891a9302a922ef1ffe300c5","modified":1541833242481},{"_id":"themes/beantech/layout/_widget/recent-posts.ejs","hash":"e08ab8ba60e31638006acf27f066b989a0a3c433","modified":1541833242481},{"_id":"themes/beantech/layout/_widget/short-about.ejs","hash":"3b10bd768f6ef30a42b1703fbc9a88627f9bfdf1","modified":1541833242482},{"_id":"themes/beantech/source/css/archive.styl","hash":"715bcbd085eb95ec26c9805c11c374919cde971c","modified":1541833242484},{"_id":"themes/beantech/source/css/beantech.css","hash":"4c361354fd8e9851923fb21a620bc079380ebcd8","modified":1541833242484},{"_id":"themes/beantech/source/css/highlight.styl","hash":"e842080e6d580f0f70a7df71fbde3c4e49463c19","modified":1541833242486},{"_id":"themes/beantech/source/css/beantech.min.css","hash":"05a06230b1a9eca0b30cece54a397008cb77dc50","modified":1541833242484},{"_id":"themes/beantech/source/css/rocket.styl","hash":"e15c51c8566ecd943112e57592888dd318b6fa6a","modified":1541833242487},{"_id":"themes/beantech/source/css/hux-blog.min.css","hash":"1baef04de262aeb7023d835429b49a805ac4ab40","modified":1541833242486},{"_id":"themes/beantech/source/css/signature.styl","hash":"88159b31c59d59c01a0b534af57242662a2a3969","modified":1541833242487},{"_id":"themes/beantech/source/css/toc.styl","hash":"6c9a2d5f6f981624e0c4b64323493e8614efea29","modified":1541833242487},{"_id":"themes/beantech/source/css/widget.styl","hash":"7a9f735f5ef323dc2950fbd9d76daa16c9a0f1a9","modified":1541833242488},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1541833242488},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1541833242489},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1541833242490},{"_id":"themes/beantech/source/js/hux-blog.min.js","hash":"1563e7f70550ac6b30803d6f449719b853200e35","modified":1541833242491},{"_id":"themes/beantech/source/js/bootstrap.min.js","hash":"b3f2ef9f985e7906c9360756b73cd64bf7733647","modified":1541833242491},{"_id":"themes/beantech/source/js/hux-blog.js","hash":"4b4d3c557405d04c3087d36c13e2834fe05c0f73","modified":1541833242491},{"_id":"themes/beantech/source/js/jquery.nav.js","hash":"ef2160a456176a4d09cc0b95d52b27dfbbadf2d8","modified":1541833242494},{"_id":"themes/beantech/source/js/toc.js","hash":"41e52551731854224c249d53010c1bae5aa92ffa","modified":1541833242494},{"_id":"themes/beantech/source/js/jquery.tagcloud.js","hash":"4e5fd0b07f3bd935f2e603710447e039e3677211","modified":1541833242494},{"_id":"themes/beantech/source/js/totop.js","hash":"c05360f6fc699ac12e794b1764b4a952713a3017","modified":1541833242494},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1541833242490},{"_id":"themes/beantech/source/css/bootstrap.min.css","hash":"fec7b176a4b9a67c0eb5d184f57b84297efc23aa","modified":1541833242486},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1541833242489},{"_id":"themes/beantech/source/js/bootstrap.js","hash":"f8752e9ae24daec0a0baffd7819122f8c6fd9103","modified":1541833242490},{"_id":"themes/beantech/source/js/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1541833242494},{"_id":"themes/beantech/source/css/images/ironman.png","hash":"2f0db0ab15d466c4065d9f6102fdf829726d9e3f","modified":1541833242487},{"_id":"themes/beantech/source/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1541833242487},{"_id":"themes/beantech/source/css/bootstrap.css","hash":"41c54bf695145ae0b4d9020a1da308ceb05dcaf3","modified":1541833242485},{"_id":"themes/beantech/source/css/images/top.jpg","hash":"1e6e20be3609d58e050c64d3803206c75dd050bd","modified":1541839577830},{"_id":"themes/beantech/source/js/jquery.js","hash":"1852661bd11a09ca9b9cb63d1aa6ff390fffaf4e","modified":1541833242493},{"_id":"source/_posts/hiadmin/7vLMRNQ.jpg","hash":"e70a8eb5974c532f69a08fcc2ca57f5217846a67","modified":1542007380808},{"_id":"source/_posts/crd/7vLMRNQ.jpg","hash":"e70a8eb5974c532f69a08fcc2ca57f5217846a67","modified":1542010682491},{"_id":"source/_posts/deployment/7vLMRNQ.jpg","hash":"e70a8eb5974c532f69a08fcc2ca57f5217846a67","modified":1541837057490},{"_id":"source/img/header_img/7vLMRNQ.jpg","hash":"e70a8eb5974c532f69a08fcc2ca57f5217846a67","modified":1443934602000},{"_id":"source/_posts/python学习笔记（一）/7vLMRNQ.jpg","hash":"e70a8eb5974c532f69a08fcc2ca57f5217846a67","modified":1542639979003}],"Category":[],"Data":[],"Page":[{"layout":"404","description":"你来到了没有知识的荒原 :(","header-img":"img/404-bg.jpg","_content":"","source":"404.md","raw":"---\nlayout: 404\ndescription: \"你来到了没有知识的荒原 :(\"\nheader-img: \"img/404-bg.jpg\"\n---\n","date":"2018-11-10T07:00:42.421Z","updated":"2018-11-10T07:00:42.421Z","path":"404.html","title":"","comments":1,"_id":"cjoofzutu0000ttjrz5nl0ixr","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"about","title":"About","date":"2016-04-20T20:48:33.000Z","description":"Wish for the Best, Prepare for the Worst","header-img":"img/header_img/7vLMRNQ.jpg","comments":1,"_content":"\n> 光有好奇心而不去實踐，等於自願放棄成功機會\n> 別為自己畫地自限，Just Do It！！\n\n我不是天生的王者 但我骨子里流动着不让我低头的血液\n\n——蒙奇·D·路飞《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/a394ca75fd514e39b1e6249be86ec516_th.jpg)\n\n一个人的死，对于这个世界来说不过是多了一座坟墓，但对于相依为命的人来说、却是整个世界都被坟墓掩埋\n\n《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/34dfb8114e0a4aa9b4d815950c655373_th.jpg)\n\n我不管这个世上的人怎么说我，我只想依照我的信念做事，绝不后悔，不管现在将来都一样！\n\n——索隆《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/1b8c9e8c9f524d7383db199f6ce6e6a0_th.jpg)\n\n遇到迷茫时，任何人都会变得软弱。 一旦坚信自己可以帮到别人，他们就会变得很强大。\n\n——娜美《海贼王》\n\n人生中有些事你不竭尽所能去做，你永远不知道你自己有多出色\n![avatar](http://img.mp.itc.cn/upload/20170120/44f041d3218a4c71bd39aea57a73b089_th.jpg)\n——索隆\n\n《海贼王》\n![avatar](http://img.mp.itc.cn/upload/20170120/e14a592d8de54c3bb405d7f6af6a4de7_th.jpg)\n\n在这片海洋中，若无法向上攀游，就只有往下沉沦，是要前进或是溺死，就得看自己的选择。 既然这么不甘心，就变的更强！\n\n——斯摩格《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/c97119f2cb404166b344c3c78f2a2a79_th.jpg)\n\n灾难总是接踵而至，这正是世间的常理。你以为只要解释一下，就有谁会来救你吗？要是死了，就只能说明我不过是如此程度的男人。\n\n——罗罗诺亚·索隆《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/5b6755f8ca9f4776b8d74bc91fcef01b_th.jpg)\n\n历史虽然会一再重演，但人类却无法回到过去。\n\n——妮可·罗宾《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/8f2d8aacb9914d7d970ded6355ba356f_th.jpg)\n不知所措，才是人生。\n\n——冥王·雷利《海贼王》\n![avatar](http://img.mp.itc.cn/upload/20170120/aeb3ee0601274eb1b0221bd0d704c43c_th.jpg)\n\n胜利和败北都要品尝、经历过四处逃窜的辛酸、痛苦和悲伤的回忆、这样才能独当一面、就算痛哭流涕也没关系！\n\n——红发《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/894acd47bc634178b61e993e51660ad6_th.jpg)\n\n听着……乔巴，男子汉，即……即使……遇……到可能会杀死自己的强敌……也，也不能倒下。就算对方是……死也赢不了的敌人……男人……有时候是绝对不能逃避……战斗的……！尤其……尤其是当……伙伴的梦想……被人嘲笑的时候！\n\n——乌索普《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/b244d2ab6c6e44c98a6d4b3f5a6c9bf3.jpg)\n\n即使你现在是一个人，总有一天一定会遇上同伴的！海域是无限的，总有一天，必定会出现守护你的同伴。出生在这个世界上，绝对不会永远孤独一人！\n\n——哈古瓦鲁?D?萨龙《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg)\n\n是死是活都是听天由命，害怕的话你就输了。就让我们活在下一个瞬间吧！\n\n——黑胡子《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg)\n\n在想你，那时候你的眼神......讲述了真相！就算有100万人责备你，我也绝不怀疑女人的眼泪！\n\n——山治《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/77f08623077c4c0b996ab73fdff1c7de_th.jpg)\n\n如果，这是你的希望的话，不管什么地方，我都愿意去！\n\n——波雅·汉库克《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/f472f7e9b42d4019a54abcac05802bcd_th.jpg)\n为了路飞，我心甘情愿成为真正的怪物。\n\n——乔巴《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/f6c4e673bab34c1ca99abd5b3694b70e.jpg)\n\n倘若出生于东海的我是无名小卒的话，那么被我砍倒的你到底又是哪根地上的葱呢。\n\n——索隆《海贼王》\n\n\n![](http://img.mp.itc.cn/upload/20170120/c52483cc37a44127a639171e17fd35b4.jpg)\n\n地狱之中,绽放友谊之花;碧波荡漾,满载回忆之瓣;终有一日,定会重新怒放\n\n——Mr·2冯克雷《海贼王》\n\n\n![](http://img.mp.itc.cn/upload/20170120/bdf030e385404173bcdb7f0ff31d2ff7.jpg)","source":"about/index.md","raw":"---\nlayout: \"about\"\ntitle: \"About\"\ndate: 2016-04-21 04:48:33\ndescription: \"Wish for the Best, Prepare for the Worst\"\nheader-img: \"img/header_img/7vLMRNQ.jpg\"\ncomments: true\n---\n\n> 光有好奇心而不去實踐，等於自願放棄成功機會\n> 別為自己畫地自限，Just Do It！！\n\n我不是天生的王者 但我骨子里流动着不让我低头的血液\n\n——蒙奇·D·路飞《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/a394ca75fd514e39b1e6249be86ec516_th.jpg)\n\n一个人的死，对于这个世界来说不过是多了一座坟墓，但对于相依为命的人来说、却是整个世界都被坟墓掩埋\n\n《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/34dfb8114e0a4aa9b4d815950c655373_th.jpg)\n\n我不管这个世上的人怎么说我，我只想依照我的信念做事，绝不后悔，不管现在将来都一样！\n\n——索隆《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/1b8c9e8c9f524d7383db199f6ce6e6a0_th.jpg)\n\n遇到迷茫时，任何人都会变得软弱。 一旦坚信自己可以帮到别人，他们就会变得很强大。\n\n——娜美《海贼王》\n\n人生中有些事你不竭尽所能去做，你永远不知道你自己有多出色\n![avatar](http://img.mp.itc.cn/upload/20170120/44f041d3218a4c71bd39aea57a73b089_th.jpg)\n——索隆\n\n《海贼王》\n![avatar](http://img.mp.itc.cn/upload/20170120/e14a592d8de54c3bb405d7f6af6a4de7_th.jpg)\n\n在这片海洋中，若无法向上攀游，就只有往下沉沦，是要前进或是溺死，就得看自己的选择。 既然这么不甘心，就变的更强！\n\n——斯摩格《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/c97119f2cb404166b344c3c78f2a2a79_th.jpg)\n\n灾难总是接踵而至，这正是世间的常理。你以为只要解释一下，就有谁会来救你吗？要是死了，就只能说明我不过是如此程度的男人。\n\n——罗罗诺亚·索隆《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/5b6755f8ca9f4776b8d74bc91fcef01b_th.jpg)\n\n历史虽然会一再重演，但人类却无法回到过去。\n\n——妮可·罗宾《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/8f2d8aacb9914d7d970ded6355ba356f_th.jpg)\n不知所措，才是人生。\n\n——冥王·雷利《海贼王》\n![avatar](http://img.mp.itc.cn/upload/20170120/aeb3ee0601274eb1b0221bd0d704c43c_th.jpg)\n\n胜利和败北都要品尝、经历过四处逃窜的辛酸、痛苦和悲伤的回忆、这样才能独当一面、就算痛哭流涕也没关系！\n\n——红发《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/894acd47bc634178b61e993e51660ad6_th.jpg)\n\n听着……乔巴，男子汉，即……即使……遇……到可能会杀死自己的强敌……也，也不能倒下。就算对方是……死也赢不了的敌人……男人……有时候是绝对不能逃避……战斗的……！尤其……尤其是当……伙伴的梦想……被人嘲笑的时候！\n\n——乌索普《海贼王》\n\n![avatar](http://img.mp.itc.cn/upload/20170120/b244d2ab6c6e44c98a6d4b3f5a6c9bf3.jpg)\n\n即使你现在是一个人，总有一天一定会遇上同伴的！海域是无限的，总有一天，必定会出现守护你的同伴。出生在这个世界上，绝对不会永远孤独一人！\n\n——哈古瓦鲁?D?萨龙《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg)\n\n是死是活都是听天由命，害怕的话你就输了。就让我们活在下一个瞬间吧！\n\n——黑胡子《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg)\n\n在想你，那时候你的眼神......讲述了真相！就算有100万人责备你，我也绝不怀疑女人的眼泪！\n\n——山治《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/77f08623077c4c0b996ab73fdff1c7de_th.jpg)\n\n如果，这是你的希望的话，不管什么地方，我都愿意去！\n\n——波雅·汉库克《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/f472f7e9b42d4019a54abcac05802bcd_th.jpg)\n为了路飞，我心甘情愿成为真正的怪物。\n\n——乔巴《海贼王》\n\n![](http://img.mp.itc.cn/upload/20170120/f6c4e673bab34c1ca99abd5b3694b70e.jpg)\n\n倘若出生于东海的我是无名小卒的话，那么被我砍倒的你到底又是哪根地上的葱呢。\n\n——索隆《海贼王》\n\n\n![](http://img.mp.itc.cn/upload/20170120/c52483cc37a44127a639171e17fd35b4.jpg)\n\n地狱之中,绽放友谊之花;碧波荡漾,满载回忆之瓣;终有一日,定会重新怒放\n\n——Mr·2冯克雷《海贼王》\n\n\n![](http://img.mp.itc.cn/upload/20170120/bdf030e385404173bcdb7f0ff31d2ff7.jpg)","updated":"2018-11-10T09:08:53.541Z","path":"about/index.html","_id":"cjoofzuv40001ttjr2bl9hage","content":"<blockquote>\n<p>光有好奇心而不去實踐，等於自願放棄成功機會<br>\n別為自己畫地自限，Just Do It！！</p>\n</blockquote>\n<p>我不是天生的王者 但我骨子里流动着不让我低头的血液</p>\n<p>——蒙奇·D·路飞《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/a394ca75fd514e39b1e6249be86ec516_th.jpg\" alt=\"avatar\"></p>\n<p>一个人的死，对于这个世界来说不过是多了一座坟墓，但对于相依为命的人来说、却是整个世界都被坟墓掩埋</p>\n<p>《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/34dfb8114e0a4aa9b4d815950c655373_th.jpg\" alt=\"avatar\"></p>\n<p>我不管这个世上的人怎么说我，我只想依照我的信念做事，绝不后悔，不管现在将来都一样！</p>\n<p>——索隆《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/1b8c9e8c9f524d7383db199f6ce6e6a0_th.jpg\" alt=\"avatar\"></p>\n<p>遇到迷茫时，任何人都会变得软弱。 一旦坚信自己可以帮到别人，他们就会变得很强大。</p>\n<p>——娜美《海贼王》</p>\n<p>人生中有些事你不竭尽所能去做，你永远不知道你自己有多出色<br>\n<img src=\"http://img.mp.itc.cn/upload/20170120/44f041d3218a4c71bd39aea57a73b089_th.jpg\" alt=\"avatar\"><br>\n——索隆</p>\n<p>《海贼王》<br>\n<img src=\"http://img.mp.itc.cn/upload/20170120/e14a592d8de54c3bb405d7f6af6a4de7_th.jpg\" alt=\"avatar\"></p>\n<p>在这片海洋中，若无法向上攀游，就只有往下沉沦，是要前进或是溺死，就得看自己的选择。 既然这么不甘心，就变的更强！</p>\n<p>——斯摩格《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/c97119f2cb404166b344c3c78f2a2a79_th.jpg\" alt=\"avatar\"></p>\n<p>灾难总是接踵而至，这正是世间的常理。你以为只要解释一下，就有谁会来救你吗？要是死了，就只能说明我不过是如此程度的男人。</p>\n<p>——罗罗诺亚·索隆《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/5b6755f8ca9f4776b8d74bc91fcef01b_th.jpg\" alt=\"avatar\"></p>\n<p>历史虽然会一再重演，但人类却无法回到过去。</p>\n<p>——妮可·罗宾《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/8f2d8aacb9914d7d970ded6355ba356f_th.jpg\" alt=\"avatar\"><br>\n不知所措，才是人生。</p>\n<p>——冥王·雷利《海贼王》<br>\n<img src=\"http://img.mp.itc.cn/upload/20170120/aeb3ee0601274eb1b0221bd0d704c43c_th.jpg\" alt=\"avatar\"></p>\n<p>胜利和败北都要品尝、经历过四处逃窜的辛酸、痛苦和悲伤的回忆、这样才能独当一面、就算痛哭流涕也没关系！</p>\n<p>——红发《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/894acd47bc634178b61e993e51660ad6_th.jpg\" alt=\"avatar\"></p>\n<p>听着……乔巴，男子汉，即……即使……遇……到可能会杀死自己的强敌……也，也不能倒下。就算对方是……死也赢不了的敌人……男人……有时候是绝对不能逃避……战斗的……！尤其……尤其是当……伙伴的梦想……被人嘲笑的时候！</p>\n<p>——乌索普《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/b244d2ab6c6e44c98a6d4b3f5a6c9bf3.jpg\" alt=\"avatar\"></p>\n<p>即使你现在是一个人，总有一天一定会遇上同伴的！海域是无限的，总有一天，必定会出现守护你的同伴。出生在这个世界上，绝对不会永远孤独一人！</p>\n<p>——哈古瓦鲁?D?萨龙《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg\" alt=\"\"></p>\n<p>是死是活都是听天由命，害怕的话你就输了。就让我们活在下一个瞬间吧！</p>\n<p>——黑胡子《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg\" alt=\"\"></p>\n<p>在想你，那时候你的眼神…讲述了真相！就算有100万人责备你，我也绝不怀疑女人的眼泪！</p>\n<p>——山治《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/77f08623077c4c0b996ab73fdff1c7de_th.jpg\" alt=\"\"></p>\n<p>如果，这是你的希望的话，不管什么地方，我都愿意去！</p>\n<p>——波雅·汉库克《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/f472f7e9b42d4019a54abcac05802bcd_th.jpg\" alt=\"\"><br>\n为了路飞，我心甘情愿成为真正的怪物。</p>\n<p>——乔巴《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/f6c4e673bab34c1ca99abd5b3694b70e.jpg\" alt=\"\"></p>\n<p>倘若出生于东海的我是无名小卒的话，那么被我砍倒的你到底又是哪根地上的葱呢。</p>\n<p>——索隆《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/c52483cc37a44127a639171e17fd35b4.jpg\" alt=\"\"></p>\n<p>地狱之中,绽放友谊之花;碧波荡漾,满载回忆之瓣;终有一日,定会重新怒放</p>\n<p>——Mr·2冯克雷《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/bdf030e385404173bcdb7f0ff31d2ff7.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>光有好奇心而不去實踐，等於自願放棄成功機會<br>\n別為自己畫地自限，Just Do It！！</p>\n</blockquote>\n<p>我不是天生的王者 但我骨子里流动着不让我低头的血液</p>\n<p>——蒙奇·D·路飞《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/a394ca75fd514e39b1e6249be86ec516_th.jpg\" alt=\"avatar\"></p>\n<p>一个人的死，对于这个世界来说不过是多了一座坟墓，但对于相依为命的人来说、却是整个世界都被坟墓掩埋</p>\n<p>《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/34dfb8114e0a4aa9b4d815950c655373_th.jpg\" alt=\"avatar\"></p>\n<p>我不管这个世上的人怎么说我，我只想依照我的信念做事，绝不后悔，不管现在将来都一样！</p>\n<p>——索隆《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/1b8c9e8c9f524d7383db199f6ce6e6a0_th.jpg\" alt=\"avatar\"></p>\n<p>遇到迷茫时，任何人都会变得软弱。 一旦坚信自己可以帮到别人，他们就会变得很强大。</p>\n<p>——娜美《海贼王》</p>\n<p>人生中有些事你不竭尽所能去做，你永远不知道你自己有多出色<br>\n<img src=\"http://img.mp.itc.cn/upload/20170120/44f041d3218a4c71bd39aea57a73b089_th.jpg\" alt=\"avatar\"><br>\n——索隆</p>\n<p>《海贼王》<br>\n<img src=\"http://img.mp.itc.cn/upload/20170120/e14a592d8de54c3bb405d7f6af6a4de7_th.jpg\" alt=\"avatar\"></p>\n<p>在这片海洋中，若无法向上攀游，就只有往下沉沦，是要前进或是溺死，就得看自己的选择。 既然这么不甘心，就变的更强！</p>\n<p>——斯摩格《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/c97119f2cb404166b344c3c78f2a2a79_th.jpg\" alt=\"avatar\"></p>\n<p>灾难总是接踵而至，这正是世间的常理。你以为只要解释一下，就有谁会来救你吗？要是死了，就只能说明我不过是如此程度的男人。</p>\n<p>——罗罗诺亚·索隆《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/5b6755f8ca9f4776b8d74bc91fcef01b_th.jpg\" alt=\"avatar\"></p>\n<p>历史虽然会一再重演，但人类却无法回到过去。</p>\n<p>——妮可·罗宾《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/8f2d8aacb9914d7d970ded6355ba356f_th.jpg\" alt=\"avatar\"><br>\n不知所措，才是人生。</p>\n<p>——冥王·雷利《海贼王》<br>\n<img src=\"http://img.mp.itc.cn/upload/20170120/aeb3ee0601274eb1b0221bd0d704c43c_th.jpg\" alt=\"avatar\"></p>\n<p>胜利和败北都要品尝、经历过四处逃窜的辛酸、痛苦和悲伤的回忆、这样才能独当一面、就算痛哭流涕也没关系！</p>\n<p>——红发《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/894acd47bc634178b61e993e51660ad6_th.jpg\" alt=\"avatar\"></p>\n<p>听着……乔巴，男子汉，即……即使……遇……到可能会杀死自己的强敌……也，也不能倒下。就算对方是……死也赢不了的敌人……男人……有时候是绝对不能逃避……战斗的……！尤其……尤其是当……伙伴的梦想……被人嘲笑的时候！</p>\n<p>——乌索普《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/b244d2ab6c6e44c98a6d4b3f5a6c9bf3.jpg\" alt=\"avatar\"></p>\n<p>即使你现在是一个人，总有一天一定会遇上同伴的！海域是无限的，总有一天，必定会出现守护你的同伴。出生在这个世界上，绝对不会永远孤独一人！</p>\n<p>——哈古瓦鲁?D?萨龙《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg\" alt=\"\"></p>\n<p>是死是活都是听天由命，害怕的话你就输了。就让我们活在下一个瞬间吧！</p>\n<p>——黑胡子《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/616573deee8047c28c4d0cf38436176f_th.jpg\" alt=\"\"></p>\n<p>在想你，那时候你的眼神…讲述了真相！就算有100万人责备你，我也绝不怀疑女人的眼泪！</p>\n<p>——山治《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/77f08623077c4c0b996ab73fdff1c7de_th.jpg\" alt=\"\"></p>\n<p>如果，这是你的希望的话，不管什么地方，我都愿意去！</p>\n<p>——波雅·汉库克《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/f472f7e9b42d4019a54abcac05802bcd_th.jpg\" alt=\"\"><br>\n为了路飞，我心甘情愿成为真正的怪物。</p>\n<p>——乔巴《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/f6c4e673bab34c1ca99abd5b3694b70e.jpg\" alt=\"\"></p>\n<p>倘若出生于东海的我是无名小卒的话，那么被我砍倒的你到底又是哪根地上的葱呢。</p>\n<p>——索隆《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/c52483cc37a44127a639171e17fd35b4.jpg\" alt=\"\"></p>\n<p>地狱之中,绽放友谊之花;碧波荡漾,满载回忆之瓣;终有一日,定会重新怒放</p>\n<p>——Mr·2冯克雷《海贼王》</p>\n<p><img src=\"http://img.mp.itc.cn/upload/20170120/bdf030e385404173bcdb7f0ff31d2ff7.jpg\" alt=\"\"></p>\n"},{"layout":"archive","title":"Archives","header-img":"img/header_img/archive-bg.png","comments":0,"date":"2017-03-20T12:49:56.000Z","description":"Hey, this is archives","_content":"","source":"archive/index.md","raw":"---\nlayout: \"archive\"\ntitle: \"Archives\"\nheader-img: \"img/header_img/archive-bg.png\"\ncomments: false\ndate: 2017-03-20 20:49:56\ndescription: \"Hey, this is archives\"\n---\n","updated":"2018-11-10T07:00:42.431Z","path":"archive/index.html","_id":"cjoofzuv80003ttjru0bousto","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"tags","title":"Tags","description":"Hey, this is Tags.","header-img":"img/header_img/7vLMRNQ.jpg","_content":"","source":"tags/index.md","raw":"---\nlayout: \"tags\"\ntitle: \"Tags\"\ndescription: \"Hey, this is Tags.\"\nheader-img: \"img/header_img/7vLMRNQ.jpg\"\n---\n","date":"2018-11-10T08:05:57.124Z","updated":"2018-11-10T08:05:57.124Z","path":"tags/index.html","comments":1,"_id":"cjoofzuvx000lttjrnmxn8muk","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"python学习笔记（一）","catalog":true,"date":"2018-11-19T15:05:19.000Z","subtitle":"Python 基础学习","header-img":"7vLMRNQ.jpg","_content":"\n# python的安装\n\n因为我是用的mac开发，所以我这里只说一下mac是如何安装的\n\n方法一：从Python官网下载Python 3.7的安装程序（网速慢的同学请移步国内镜像），双击运行并安装；\n\n`https://www.python.org/ftp/python/3.7.0/python-3.7.0-macosx10.9.pkg`\n\n方法二：如果安装了Homebrew。\n\n```shell\nbrew install python3\n```\n\n在这里我需要提一下python的包管理工具`pip`\n\n如果有homebrew工具的话可以使用\n\n```shell\nbrew install pip3\n```\n\n以安装requests为例，命令：\n\n```shell\npip3 install requests\n```\n\n# python 基本语法\n\n头部需要引入\n\n```python\n#!/usr/bin/env python\n# coding:utf-8\n\n# 输出hello-world\n\nprint('hello, world')\n```\n\n## python 数据类型\n\n### 整数\n\nPython可以处理任意大小的整数，当然包括负整数，在程序中的表示方法和数学上的写法一模一样，例如：1，100，-8080，0，等等。\n\n计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示，例如：0xff00，0xa5b4c3d2，等等。\n\n### 浮点数\n\n浮点数也就是小数，之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的，比如，1.23x109和12.3x108是完全相等的。浮点数可以用数学写法，如1.23，3.14，-9.01，等等。但是对于很大或很小的浮点数，就必须用科学计数法表示，把10用e替代，1.23x109就是1.23e9，或者12.3e8，0.000012可以写成1.2e-5，等等。\n\n整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的（除法难道也是精确的？是的！），而浮点数运算则可能会有四舍五入的误差。\n\n### 字符串\n\n字符串是以单引号'或双引号\"括起来的任意文本，比如'abc'，\"xyz\"等等。\n","source":"_posts/python学习笔记（一）.md","raw":"---\ntitle: python学习笔记（一）\ncatalog: true\ndate: 2018-11-19 23:05:19\nsubtitle: Python 基础学习\nheader-img: 7vLMRNQ.jpg\ntags: Python\n---\n\n# python的安装\n\n因为我是用的mac开发，所以我这里只说一下mac是如何安装的\n\n方法一：从Python官网下载Python 3.7的安装程序（网速慢的同学请移步国内镜像），双击运行并安装；\n\n`https://www.python.org/ftp/python/3.7.0/python-3.7.0-macosx10.9.pkg`\n\n方法二：如果安装了Homebrew。\n\n```shell\nbrew install python3\n```\n\n在这里我需要提一下python的包管理工具`pip`\n\n如果有homebrew工具的话可以使用\n\n```shell\nbrew install pip3\n```\n\n以安装requests为例，命令：\n\n```shell\npip3 install requests\n```\n\n# python 基本语法\n\n头部需要引入\n\n```python\n#!/usr/bin/env python\n# coding:utf-8\n\n# 输出hello-world\n\nprint('hello, world')\n```\n\n## python 数据类型\n\n### 整数\n\nPython可以处理任意大小的整数，当然包括负整数，在程序中的表示方法和数学上的写法一模一样，例如：1，100，-8080，0，等等。\n\n计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示，例如：0xff00，0xa5b4c3d2，等等。\n\n### 浮点数\n\n浮点数也就是小数，之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的，比如，1.23x109和12.3x108是完全相等的。浮点数可以用数学写法，如1.23，3.14，-9.01，等等。但是对于很大或很小的浮点数，就必须用科学计数法表示，把10用e替代，1.23x109就是1.23e9，或者12.3e8，0.000012可以写成1.2e-5，等等。\n\n整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的（除法难道也是精确的？是的！），而浮点数运算则可能会有四舍五入的误差。\n\n### 字符串\n\n字符串是以单引号'或双引号\"括起来的任意文本，比如'abc'，\"xyz\"等等。\n","slug":"python学习笔记（一）","published":1,"updated":"2018-11-19T15:41:10.352Z","_id":"cjoofzuv50002ttjrgbg6o50i","comments":1,"layout":"post","photos":[],"link":"","content":"<h1><span id=\"python的安装\">python的安装</span></h1>\n<p>因为我是用的mac开发，所以我这里只说一下mac是如何安装的</p>\n<p>方法一：从Python官网下载Python 3.7的安装程序（网速慢的同学请移步国内镜像），双击运行并安装；</p>\n<p><code>https://www.python.org/ftp/python/3.7.0/python-3.7.0-macosx10.9.pkg</code></p>\n<p>方法二：如果安装了Homebrew。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install python3</span><br></pre></td></tr></table></figure>\n<p>在这里我需要提一下python的包管理工具<code>pip</code></p>\n<p>如果有homebrew工具的话可以使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install pip3</span><br></pre></td></tr></table></figure>\n<p>以安装requests为例，命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install requests</span><br></pre></td></tr></table></figure>\n<h1><span id=\"python-基本语法\">python 基本语法</span></h1>\n<p>头部需要引入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># coding:utf-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出hello-world</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(<span class=\"string\">'hello, world'</span>)</span><br></pre></td></tr></table></figure>\n<h2><span id=\"python-数据类型\">python 数据类型</span></h2>\n<h3><span id=\"整数\">整数</span></h3>\n<p>Python可以处理任意大小的整数，当然包括负整数，在程序中的表示方法和数学上的写法一模一样，例如：1，100，-8080，0，等等。</p>\n<p>计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示，例如：0xff00，0xa5b4c3d2，等等。</p>\n<h3><span id=\"浮点数\">浮点数</span></h3>\n<p>浮点数也就是小数，之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的，比如，1.23x109和12.3x108是完全相等的。浮点数可以用数学写法，如1.23，3.14，-9.01，等等。但是对于很大或很小的浮点数，就必须用科学计数法表示，把10用e替代，1.23x109就是1.23e9，或者12.3e8，0.000012可以写成1.2e-5，等等。</p>\n<p>整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的（除法难道也是精确的？是的！），而浮点数运算则可能会有四舍五入的误差。</p>\n<h3><span id=\"字符串\">字符串</span></h3>\n<p>字符串是以单引号’或双引号&quot;括起来的任意文本，比如’abc’，&quot;xyz&quot;等等。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1>python的安装</h1>\n<p>因为我是用的mac开发，所以我这里只说一下mac是如何安装的</p>\n<p>方法一：从Python官网下载Python 3.7的安装程序（网速慢的同学请移步国内镜像），双击运行并安装；</p>\n<p><code>https://www.python.org/ftp/python/3.7.0/python-3.7.0-macosx10.9.pkg</code></p>\n<p>方法二：如果安装了Homebrew。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install python3</span><br></pre></td></tr></table></figure>\n<p>在这里我需要提一下python的包管理工具<code>pip</code></p>\n<p>如果有homebrew工具的话可以使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install pip3</span><br></pre></td></tr></table></figure>\n<p>以安装requests为例，命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install requests</span><br></pre></td></tr></table></figure>\n<h1>python 基本语法</h1>\n<p>头部需要引入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># coding:utf-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出hello-world</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(<span class=\"string\">'hello, world'</span>)</span><br></pre></td></tr></table></figure>\n<h2>python 数据类型</h2>\n<h3>整数</h3>\n<p>Python可以处理任意大小的整数，当然包括负整数，在程序中的表示方法和数学上的写法一模一样，例如：1，100，-8080，0，等等。</p>\n<p>计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示，例如：0xff00，0xa5b4c3d2，等等。</p>\n<h3>浮点数</h3>\n<p>浮点数也就是小数，之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的，比如，1.23x109和12.3x108是完全相等的。浮点数可以用数学写法，如1.23，3.14，-9.01，等等。但是对于很大或很小的浮点数，就必须用科学计数法表示，把10用e替代，1.23x109就是1.23e9，或者12.3e8，0.000012可以写成1.2e-5，等等。</p>\n<p>整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的（除法难道也是精确的？是的！），而浮点数运算则可能会有四舍五入的误差。</p>\n<h3>字符串</h3>\n<p>字符串是以单引号’或双引号&quot;括起来的任意文本，比如’abc’，&quot;xyz&quot;等等。</p>\n"},{"title":"crd","catalog":true,"date":"2018-11-12T08:17:28.000Z","header-img":"7vLMRNQ.jpg","subtitle":"crd资源的整合","_content":"\n# 首先创建资源\n\n```bash\n#如果在openshift中创建资源\noc apply -f deploymentconfig-crd.yaml\n\n#若在k8s中创建资源\nkubectl apply -f deploymentconfig-crd.yaml\n```\n\ncrd 资源demo\n\n```yaml\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: builds.mio.io\nspec:\n  group: mio.io\n  version: v1alpha1\n  names:\n    kind: Build\n    plural: builds\n  scope: Namespaced\n```\n\n# pipelineconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: PipelineConfig\nmetadata:\n  creationTimestamp: 2018-10-15T08:12:49Z\n  generation: 0\n  name: java\n  namespace: templates\n  resourceVersion: \"125861171\"\n  selfLink: /apis/mio.io/v1alpha1/namespaces/templates/pipelineconfigs/java\n  uid: 1b3cbbc0-d052-11e8-b78c-005056935c80\nspec:\n  app: \"\"\n  dockerRegistry: \"\"\n  events:\n  - eventTypes: buildPipeline\n    name: java\n  - eventTypes: deploy\n    name: java\n  - eventTypes: deploy\n    name: java-test\n  - eventTypes: service\n    name: java\n  - eventTypes: gateway\n    name: java\n  profile: dev\n  version: v2\nstatus: {}\n```\n\n# buildconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: BuildConfig\nmetadata:\n  creationTimestamp: 2018-10-23T08:29:45Z\n  generation: 0\n  name: java\n  namespace: templates\nspec:\n  baseImage: docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22 # hinode镜像地址\n  cloneConfig:\n    branch: master #拉取代码的分支\n    dstDir: /opt/app-root/src/vpclub # 默认地址\n    url: https://gitlab.vpclub.cn # 拉取 代码的基础地址\n  codeType: java # 代码类型\n  compileCmd:\n  - commandName: pwd\n  - Script: |-\n      mvn clean package -U -Dmaven.test.skip=true -Djava.net.preferIPv4Stack=true\n      if [[ $? == 0 ]]; then\n        echo 'Build Successful.'\n      else\n        echo 'Build Failed!'\n        exit 1\n      fi\n    execType: script\n  - commandName: pwd\n  - Script: ls\n    execType: script\n  deployData:\n    envs: # deploy\n      CODE_TYPE: java\n      DOCKER_API_VERSION: \"1.24\" # docker api 版本号\n      MAVEN_MIRROR_URL: http://nexus.vpclub.cn/repository/maven-public/ #maven仓库地址\n    hostPathVolume:\n      /var/lib/docker: /var/lib/docker #挂载目录\n      /var/run/docker.sock: /var/run/docker.sock\n    ports:\n    - 8080 #暴露端口\n    - 7575\n    replicas: 1 # replicas pod的数量\n  dockerAuthConfig:\n    password: #docker鉴权所需要的账号密码\n    username: unused\n  dockerFile: # 制作 镜像的 dockerfile\n  - FROM clarechu/base-image-java:0.1\n  - ENV  TZ=\"Asia/Shanghai\"\n  - ENV  APP_OPTIONS=\"-Xms128m -Xmx512m -Xss512k\"\n  - ENV   APP_OPTIONS=\"-Xms128m -Xmx512m -Xss512k\"\n  - USER 0\n  - RUN  useradd -u 1002 -r -g 0 -d ${HOME} -s /sbin/nologin -c \"Default Application\n    User\" java\n  - COPY ./app.jar ${HOME}\n  - RUN chown -R 1001:0 ${HOME}\n  - USER 1002\n  - EXPOSE 8080\n  - EXPOSE 7575\n  - ENTRYPOINT [\"sh\",\"-c\",\"java -jar $HOME/app.jar $APP_OPTIONS\"]\n  dockerRegistry: docker-registry-default.app.vpclub.io #上传的镜像仓库地址\n  tasks: #流程\n  - name: createService #创建 hinode 的service\n  - name: deployNode # 创建deployment\n  - name: clone # clone代码\n  - name: compile # 编译clone下来的代码\n  - name: buildImage # 编译镜像\n  - name: pushImage # 推镜像\n  - name: deleteDeployment # 删除hinode资源 和 service\nstatus:\n  lastVersion: 1\n```\n\n# deploymentconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: DeploymentConfig\nmetadata:\n  name: java-test\n  namespace: templates\nspec:\n  dockerRegistry: docker-registry.default.svc:5000\n  env:\n  - name: starter\n    value: jav -jar\n  - name: TZ\n    value: Asia/Shanghai\n  - name: APP_OPTIONS\n    value: -Xms128m -Xmx512m -Xss512k\n  - name: SPRING_PROFILES_ACTIVE\n    value: test\n  envType:\n  - remoteDeploy\n  - deploy\n  fromRegistry: docker-registry-default.app.vpclub.io\n  port:\n  - containerPort: 8080\n    name: tcp-8080\n    protocol: TCP\n  profile: test #部署环境\nstatus:\n  lastVersion: 1\n```\n\n# sourceconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: SourceConfig\nmetadata:\n  name: java-source\nspec:\n  scm:\n    apiVersion: v3\n    ref: master\n    token: \"\"\n    url: http://gitlab.vpclub:8022\n  sourceCode:\n  - content: <packaging>jar</packaging>\n    path: pom.xml\n    type: java\nstatus:\n  metadata: {}\n```\n\n# gatewayconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: GatewayConfig\nmetadata:\n  clusterName: \"\"\n  creationTimestamp: 2018-10-26T09:01:51Z\n  generation: 0\n  name: java\n  namespace: templates\nspec:\n  eventType: null\n  hosts:\n  - dev.vpclub.cn\n  httpIfTerminated: false\n  httpsOnly: false\n  kongAdminUrl: http://kong-admin-kong-dev.app.vpclub.io\n  preserveHost: true\n  profile: dev\n  retries: \"5\"\n  stripUri: true\n  upstreamConnectTimeout: 60000\n  upstreamReadTimeout: 60000\n  upstreamSendTimeout: 60000\n  upstreamUrl: \"\"\n  uris: null\nstatus:\n  metadata: {}\n```\n\n# serviceconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: ServiceConfig\nmetadata:\n  clusterName: \"\"\n  creationTimestamp: 2018-10-26T07:31:26Z\n  generation: 0\n  labels:\n    profile: dev\n  name: java\n  namespace: templates\nspec:\n  ports:\n  - name: http-8080\n    port: 8080\n    protocol: TCP\n    targetPort: 8080\n  - name: http-7575\n    port: 7575\n    protocol: TCP\n    targetPort: 7575\nstatus:\n  metadata: {}\n```\n","source":"_posts/crd.md","raw":"---\ntitle: crd\ncatalog: true\ndate: 2018-11-12 16:17:28\nheader-img: \"7vLMRNQ.jpg\"\ntags:\n- crd\n- k8s\nsubtitle: crd资源的整合\n---\n\n# 首先创建资源\n\n```bash\n#如果在openshift中创建资源\noc apply -f deploymentconfig-crd.yaml\n\n#若在k8s中创建资源\nkubectl apply -f deploymentconfig-crd.yaml\n```\n\ncrd 资源demo\n\n```yaml\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: builds.mio.io\nspec:\n  group: mio.io\n  version: v1alpha1\n  names:\n    kind: Build\n    plural: builds\n  scope: Namespaced\n```\n\n# pipelineconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: PipelineConfig\nmetadata:\n  creationTimestamp: 2018-10-15T08:12:49Z\n  generation: 0\n  name: java\n  namespace: templates\n  resourceVersion: \"125861171\"\n  selfLink: /apis/mio.io/v1alpha1/namespaces/templates/pipelineconfigs/java\n  uid: 1b3cbbc0-d052-11e8-b78c-005056935c80\nspec:\n  app: \"\"\n  dockerRegistry: \"\"\n  events:\n  - eventTypes: buildPipeline\n    name: java\n  - eventTypes: deploy\n    name: java\n  - eventTypes: deploy\n    name: java-test\n  - eventTypes: service\n    name: java\n  - eventTypes: gateway\n    name: java\n  profile: dev\n  version: v2\nstatus: {}\n```\n\n# buildconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: BuildConfig\nmetadata:\n  creationTimestamp: 2018-10-23T08:29:45Z\n  generation: 0\n  name: java\n  namespace: templates\nspec:\n  baseImage: docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22 # hinode镜像地址\n  cloneConfig:\n    branch: master #拉取代码的分支\n    dstDir: /opt/app-root/src/vpclub # 默认地址\n    url: https://gitlab.vpclub.cn # 拉取 代码的基础地址\n  codeType: java # 代码类型\n  compileCmd:\n  - commandName: pwd\n  - Script: |-\n      mvn clean package -U -Dmaven.test.skip=true -Djava.net.preferIPv4Stack=true\n      if [[ $? == 0 ]]; then\n        echo 'Build Successful.'\n      else\n        echo 'Build Failed!'\n        exit 1\n      fi\n    execType: script\n  - commandName: pwd\n  - Script: ls\n    execType: script\n  deployData:\n    envs: # deploy\n      CODE_TYPE: java\n      DOCKER_API_VERSION: \"1.24\" # docker api 版本号\n      MAVEN_MIRROR_URL: http://nexus.vpclub.cn/repository/maven-public/ #maven仓库地址\n    hostPathVolume:\n      /var/lib/docker: /var/lib/docker #挂载目录\n      /var/run/docker.sock: /var/run/docker.sock\n    ports:\n    - 8080 #暴露端口\n    - 7575\n    replicas: 1 # replicas pod的数量\n  dockerAuthConfig:\n    password: #docker鉴权所需要的账号密码\n    username: unused\n  dockerFile: # 制作 镜像的 dockerfile\n  - FROM clarechu/base-image-java:0.1\n  - ENV  TZ=\"Asia/Shanghai\"\n  - ENV  APP_OPTIONS=\"-Xms128m -Xmx512m -Xss512k\"\n  - ENV   APP_OPTIONS=\"-Xms128m -Xmx512m -Xss512k\"\n  - USER 0\n  - RUN  useradd -u 1002 -r -g 0 -d ${HOME} -s /sbin/nologin -c \"Default Application\n    User\" java\n  - COPY ./app.jar ${HOME}\n  - RUN chown -R 1001:0 ${HOME}\n  - USER 1002\n  - EXPOSE 8080\n  - EXPOSE 7575\n  - ENTRYPOINT [\"sh\",\"-c\",\"java -jar $HOME/app.jar $APP_OPTIONS\"]\n  dockerRegistry: docker-registry-default.app.vpclub.io #上传的镜像仓库地址\n  tasks: #流程\n  - name: createService #创建 hinode 的service\n  - name: deployNode # 创建deployment\n  - name: clone # clone代码\n  - name: compile # 编译clone下来的代码\n  - name: buildImage # 编译镜像\n  - name: pushImage # 推镜像\n  - name: deleteDeployment # 删除hinode资源 和 service\nstatus:\n  lastVersion: 1\n```\n\n# deploymentconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: DeploymentConfig\nmetadata:\n  name: java-test\n  namespace: templates\nspec:\n  dockerRegistry: docker-registry.default.svc:5000\n  env:\n  - name: starter\n    value: jav -jar\n  - name: TZ\n    value: Asia/Shanghai\n  - name: APP_OPTIONS\n    value: -Xms128m -Xmx512m -Xss512k\n  - name: SPRING_PROFILES_ACTIVE\n    value: test\n  envType:\n  - remoteDeploy\n  - deploy\n  fromRegistry: docker-registry-default.app.vpclub.io\n  port:\n  - containerPort: 8080\n    name: tcp-8080\n    protocol: TCP\n  profile: test #部署环境\nstatus:\n  lastVersion: 1\n```\n\n# sourceconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: SourceConfig\nmetadata:\n  name: java-source\nspec:\n  scm:\n    apiVersion: v3\n    ref: master\n    token: \"\"\n    url: http://gitlab.vpclub:8022\n  sourceCode:\n  - content: <packaging>jar</packaging>\n    path: pom.xml\n    type: java\nstatus:\n  metadata: {}\n```\n\n# gatewayconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: GatewayConfig\nmetadata:\n  clusterName: \"\"\n  creationTimestamp: 2018-10-26T09:01:51Z\n  generation: 0\n  name: java\n  namespace: templates\nspec:\n  eventType: null\n  hosts:\n  - dev.vpclub.cn\n  httpIfTerminated: false\n  httpsOnly: false\n  kongAdminUrl: http://kong-admin-kong-dev.app.vpclub.io\n  preserveHost: true\n  profile: dev\n  retries: \"5\"\n  stripUri: true\n  upstreamConnectTimeout: 60000\n  upstreamReadTimeout: 60000\n  upstreamSendTimeout: 60000\n  upstreamUrl: \"\"\n  uris: null\nstatus:\n  metadata: {}\n```\n\n# serviceconfig 资源\n\n```yaml\napiVersion: mio.io/v1alpha1\nkind: ServiceConfig\nmetadata:\n  clusterName: \"\"\n  creationTimestamp: 2018-10-26T07:31:26Z\n  generation: 0\n  labels:\n    profile: dev\n  name: java\n  namespace: templates\nspec:\n  ports:\n  - name: http-8080\n    port: 8080\n    protocol: TCP\n    targetPort: 8080\n  - name: http-7575\n    port: 7575\n    protocol: TCP\n    targetPort: 7575\nstatus:\n  metadata: {}\n```\n","slug":"crd","published":1,"updated":"2018-11-12T13:32:41.585Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjoofzuv80004ttjrphglwkv6","content":"<h1><span id=\"首先创建资源\">首先创建资源</span></h1>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#如果在openshift中创建资源</span></span><br><span class=\"line\">oc apply -f deploymentconfig-crd.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#若在k8s中创建资源</span></span><br><span class=\"line\">kubectl apply -f deploymentconfig-crd.yaml</span><br></pre></td></tr></table></figure>\n<p>crd 资源demo</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiextensions.k8s.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">CustomResourceDefinition</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">builds.mio.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  group:</span> <span class=\"string\">mio.io</span></span><br><span class=\"line\"><span class=\"attr\">  version:</span> <span class=\"string\">v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">  names:</span></span><br><span class=\"line\"><span class=\"attr\">    kind:</span> <span class=\"string\">Build</span></span><br><span class=\"line\"><span class=\"attr\">    plural:</span> <span class=\"string\">builds</span></span><br><span class=\"line\"><span class=\"attr\">  scope:</span> <span class=\"string\">Namespaced</span></span><br></pre></td></tr></table></figure>\n<h1><span id=\"pipelineconfig-资源\">pipelineconfig 资源</span></h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PipelineConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-15</span><span class=\"attr\">T08:12:49Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">  resourceVersion:</span> <span class=\"string\">\"125861171\"</span></span><br><span class=\"line\"><span class=\"attr\">  selfLink:</span> <span class=\"string\">/apis/mio.io/v1alpha1/namespaces/templates/pipelineconfigs/java</span></span><br><span class=\"line\"><span class=\"attr\">  uid:</span> <span class=\"number\">1</span><span class=\"string\">b3cbbc0-d052-11e8-b78c-005056935c80</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  app:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  dockerRegistry:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  events:</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">buildPipeline</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">deploy</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">deploy</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java-test</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">service</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">gateway</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  profile:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">  version:</span> <span class=\"string\">v2</span></span><br><span class=\"line\"><span class=\"attr\">status:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n<h1><span id=\"buildconfig-资源\">buildconfig 资源</span></h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">BuildConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-23</span><span class=\"attr\">T08:29:45Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  baseImage:</span> <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22</span> <span class=\"comment\"># hinode镜像地址</span></span><br><span class=\"line\"><span class=\"attr\">  cloneConfig:</span></span><br><span class=\"line\"><span class=\"attr\">    branch:</span> <span class=\"string\">master</span> <span class=\"comment\">#拉取代码的分支</span></span><br><span class=\"line\"><span class=\"attr\">    dstDir:</span> <span class=\"string\">/opt/app-root/src/vpclub</span> <span class=\"comment\"># 默认地址</span></span><br><span class=\"line\"><span class=\"attr\">    url:</span> <span class=\"attr\">https://gitlab.vpclub.cn</span> <span class=\"comment\"># 拉取 代码的基础地址</span></span><br><span class=\"line\"><span class=\"attr\">  codeType:</span> <span class=\"string\">java</span> <span class=\"comment\"># 代码类型</span></span><br><span class=\"line\"><span class=\"attr\">  compileCmd:</span></span><br><span class=\"line\"><span class=\"attr\">  - commandName:</span> <span class=\"string\">pwd</span></span><br><span class=\"line\"><span class=\"attr\">  - Script:</span> <span class=\"string\">|-</span></span><br><span class=\"line\">      <span class=\"string\">mvn</span> <span class=\"string\">clean</span> <span class=\"string\">package</span> <span class=\"bullet\">-U</span> <span class=\"bullet\">-Dmaven.test.skip=true</span> <span class=\"bullet\">-Djava.net.preferIPv4Stack=true</span></span><br><span class=\"line\">      <span class=\"string\">if</span> <span class=\"string\">[[</span> <span class=\"string\">$?</span> <span class=\"string\">==</span> <span class=\"number\">0</span> <span class=\"string\">]];</span> <span class=\"string\">then</span></span><br><span class=\"line\">        <span class=\"string\">echo</span> <span class=\"string\">'Build Successful.'</span></span><br><span class=\"line\">      <span class=\"string\">else</span></span><br><span class=\"line\">        <span class=\"string\">echo</span> <span class=\"string\">'Build Failed!'</span></span><br><span class=\"line\">        <span class=\"string\">exit</span> <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"string\">fi</span></span><br><span class=\"line\"><span class=\"attr\">    execType:</span> <span class=\"string\">script</span></span><br><span class=\"line\"><span class=\"attr\">  - commandName:</span> <span class=\"string\">pwd</span></span><br><span class=\"line\"><span class=\"attr\">  - Script:</span> <span class=\"string\">ls</span></span><br><span class=\"line\"><span class=\"attr\">    execType:</span> <span class=\"string\">script</span></span><br><span class=\"line\"><span class=\"attr\">  deployData:</span></span><br><span class=\"line\"><span class=\"attr\">    envs:</span> <span class=\"comment\"># deploy</span></span><br><span class=\"line\"><span class=\"attr\">      CODE_TYPE:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">      DOCKER_API_VERSION:</span> <span class=\"string\">\"1.24\"</span> <span class=\"comment\"># docker api 版本号</span></span><br><span class=\"line\"><span class=\"attr\">      MAVEN_MIRROR_URL:</span> <span class=\"attr\">http://nexus.vpclub.cn/repository/maven-public/</span> <span class=\"comment\">#maven仓库地址</span></span><br><span class=\"line\"><span class=\"attr\">    hostPathVolume:</span></span><br><span class=\"line\">      <span class=\"string\">/var/lib/docker:</span> <span class=\"string\">/var/lib/docker</span> <span class=\"comment\">#挂载目录</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/docker.sock:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"number\">8080</span> <span class=\"comment\">#暴露端口</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">    replicas:</span> <span class=\"number\">1</span> <span class=\"comment\"># replicas pod的数量</span></span><br><span class=\"line\"><span class=\"attr\">  dockerAuthConfig:</span></span><br><span class=\"line\"><span class=\"attr\">    password:</span> <span class=\"comment\">#docker鉴权所需要的账号密码</span></span><br><span class=\"line\"><span class=\"attr\">    username:</span> <span class=\"string\">unused</span></span><br><span class=\"line\"><span class=\"attr\">  dockerFile:</span> <span class=\"comment\"># 制作 镜像的 dockerfile</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">FROM</span> <span class=\"string\">clarechu/base-image-java:0.1</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENV</span>  <span class=\"string\">TZ=\"Asia/Shanghai\"</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENV</span>  <span class=\"string\">APP_OPTIONS=\"-Xms128m</span> <span class=\"bullet\">-Xmx512m</span> <span class=\"bullet\">-Xss512k\"</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENV</span>   <span class=\"string\">APP_OPTIONS=\"-Xms128m</span> <span class=\"bullet\">-Xmx512m</span> <span class=\"bullet\">-Xss512k\"</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">USER</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">RUN</span>  <span class=\"string\">useradd</span> <span class=\"bullet\">-u</span> <span class=\"number\">1002</span> <span class=\"bullet\">-r</span> <span class=\"bullet\">-g</span> <span class=\"number\">0</span> <span class=\"bullet\">-d</span> <span class=\"string\">$&#123;HOME&#125;</span> <span class=\"bullet\">-s</span> <span class=\"string\">/sbin/nologin</span> <span class=\"bullet\">-c</span> <span class=\"string\">\"Default Application</span></span><br><span class=\"line\"><span class=\"string\">    User\"</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">COPY</span> <span class=\"string\">./app.jar</span> <span class=\"string\">$&#123;HOME&#125;</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">RUN</span> <span class=\"string\">chown</span> <span class=\"bullet\">-R</span> <span class=\"number\">1001</span><span class=\"string\">:0</span> <span class=\"string\">$&#123;HOME&#125;</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">USER</span> <span class=\"number\">1002</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">EXPOSE</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">EXPOSE</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENTRYPOINT</span> <span class=\"string\">[\"sh\",\"-c\",\"java</span> <span class=\"bullet\">-jar</span> <span class=\"string\">$HOME/app.jar</span> <span class=\"string\">$APP_OPTIONS\"]</span></span><br><span class=\"line\"><span class=\"attr\">  dockerRegistry:</span> <span class=\"string\">docker-registry-default.app.vpclub.io</span> <span class=\"comment\">#上传的镜像仓库地址</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span> <span class=\"comment\">#流程</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">createService</span> <span class=\"comment\">#创建 hinode 的service</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">deployNode</span> <span class=\"comment\"># 创建deployment</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">clone</span> <span class=\"comment\"># clone代码</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">compile</span> <span class=\"comment\"># 编译clone下来的代码</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">buildImage</span> <span class=\"comment\"># 编译镜像</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">pushImage</span> <span class=\"comment\"># 推镜像</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">deleteDeployment</span> <span class=\"comment\"># 删除hinode资源 和 service</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  lastVersion:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h1><span id=\"deploymentconfig-资源\">deploymentconfig 资源</span></h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DeploymentConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java-test</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  dockerRegistry:</span> <span class=\"string\">docker-registry.default.svc:5000</span></span><br><span class=\"line\"><span class=\"attr\">  env:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">starter</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"string\">jav</span> <span class=\"bullet\">-jar</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">TZ</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"string\">Asia/Shanghai</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">APP_OPTIONS</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"bullet\">-Xms128m</span> <span class=\"bullet\">-Xmx512m</span> <span class=\"bullet\">-Xss512k</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">SPRING_PROFILES_ACTIVE</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"string\">test</span></span><br><span class=\"line\"><span class=\"attr\">  envType:</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">remoteDeploy</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">deploy</span></span><br><span class=\"line\"><span class=\"attr\">  fromRegistry:</span> <span class=\"string\">docker-registry-default.app.vpclub.io</span></span><br><span class=\"line\"><span class=\"attr\">  port:</span></span><br><span class=\"line\"><span class=\"attr\">  - containerPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">tcp-8080</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">  profile:</span> <span class=\"string\">test</span> <span class=\"comment\">#部署环境</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  lastVersion:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h1><span id=\"sourceconfig-资源\">sourceconfig 资源</span></h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">SourceConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java-source</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  scm:</span></span><br><span class=\"line\"><span class=\"attr\">    apiVersion:</span> <span class=\"string\">v3</span></span><br><span class=\"line\"><span class=\"attr\">    ref:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    token:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">    url:</span> <span class=\"attr\">http://gitlab.vpclub:8022</span></span><br><span class=\"line\"><span class=\"attr\">  sourceCode:</span></span><br><span class=\"line\"><span class=\"attr\">  - content:</span> <span class=\"string\">&lt;packaging&gt;jar&lt;/packaging&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    path:</span> <span class=\"string\">pom.xml</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  metadata:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n<h1><span id=\"gatewayconfig-资源\">gatewayconfig 资源</span></h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">GatewayConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  clusterName:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-26</span><span class=\"attr\">T09:01:51Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  eventType:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"attr\">  hosts:</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">dev.vpclub.cn</span></span><br><span class=\"line\"><span class=\"attr\">  httpIfTerminated:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  httpsOnly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  kongAdminUrl:</span> <span class=\"attr\">http://kong-admin-kong-dev.app.vpclub.io</span></span><br><span class=\"line\"><span class=\"attr\">  preserveHost:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  profile:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">  retries:</span> <span class=\"string\">\"5\"</span></span><br><span class=\"line\"><span class=\"attr\">  stripUri:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamConnectTimeout:</span> <span class=\"number\">60000</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamReadTimeout:</span> <span class=\"number\">60000</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamSendTimeout:</span> <span class=\"number\">60000</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamUrl:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  uris:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  metadata:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n<h1><span id=\"serviceconfig-资源\">serviceconfig 资源</span></h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  clusterName:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-26</span><span class=\"attr\">T07:31:26Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    profile:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">http-8080</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">http-7575</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  metadata:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1>首先创建资源</h1>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#如果在openshift中创建资源</span></span><br><span class=\"line\">oc apply -f deploymentconfig-crd.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#若在k8s中创建资源</span></span><br><span class=\"line\">kubectl apply -f deploymentconfig-crd.yaml</span><br></pre></td></tr></table></figure>\n<p>crd 资源demo</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiextensions.k8s.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">CustomResourceDefinition</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">builds.mio.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  group:</span> <span class=\"string\">mio.io</span></span><br><span class=\"line\"><span class=\"attr\">  version:</span> <span class=\"string\">v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">  names:</span></span><br><span class=\"line\"><span class=\"attr\">    kind:</span> <span class=\"string\">Build</span></span><br><span class=\"line\"><span class=\"attr\">    plural:</span> <span class=\"string\">builds</span></span><br><span class=\"line\"><span class=\"attr\">  scope:</span> <span class=\"string\">Namespaced</span></span><br></pre></td></tr></table></figure>\n<h1>pipelineconfig 资源</h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PipelineConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-15</span><span class=\"attr\">T08:12:49Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">  resourceVersion:</span> <span class=\"string\">\"125861171\"</span></span><br><span class=\"line\"><span class=\"attr\">  selfLink:</span> <span class=\"string\">/apis/mio.io/v1alpha1/namespaces/templates/pipelineconfigs/java</span></span><br><span class=\"line\"><span class=\"attr\">  uid:</span> <span class=\"number\">1</span><span class=\"string\">b3cbbc0-d052-11e8-b78c-005056935c80</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  app:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  dockerRegistry:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  events:</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">buildPipeline</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">deploy</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">deploy</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java-test</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">service</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  - eventTypes:</span> <span class=\"string\">gateway</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  profile:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">  version:</span> <span class=\"string\">v2</span></span><br><span class=\"line\"><span class=\"attr\">status:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n<h1>buildconfig 资源</h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">BuildConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-23</span><span class=\"attr\">T08:29:45Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  baseImage:</span> <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22</span> <span class=\"comment\"># hinode镜像地址</span></span><br><span class=\"line\"><span class=\"attr\">  cloneConfig:</span></span><br><span class=\"line\"><span class=\"attr\">    branch:</span> <span class=\"string\">master</span> <span class=\"comment\">#拉取代码的分支</span></span><br><span class=\"line\"><span class=\"attr\">    dstDir:</span> <span class=\"string\">/opt/app-root/src/vpclub</span> <span class=\"comment\"># 默认地址</span></span><br><span class=\"line\"><span class=\"attr\">    url:</span> <span class=\"attr\">https://gitlab.vpclub.cn</span> <span class=\"comment\"># 拉取 代码的基础地址</span></span><br><span class=\"line\"><span class=\"attr\">  codeType:</span> <span class=\"string\">java</span> <span class=\"comment\"># 代码类型</span></span><br><span class=\"line\"><span class=\"attr\">  compileCmd:</span></span><br><span class=\"line\"><span class=\"attr\">  - commandName:</span> <span class=\"string\">pwd</span></span><br><span class=\"line\"><span class=\"attr\">  - Script:</span> <span class=\"string\">|-</span></span><br><span class=\"line\">      <span class=\"string\">mvn</span> <span class=\"string\">clean</span> <span class=\"string\">package</span> <span class=\"bullet\">-U</span> <span class=\"bullet\">-Dmaven.test.skip=true</span> <span class=\"bullet\">-Djava.net.preferIPv4Stack=true</span></span><br><span class=\"line\">      <span class=\"string\">if</span> <span class=\"string\">[[</span> <span class=\"string\">$?</span> <span class=\"string\">==</span> <span class=\"number\">0</span> <span class=\"string\">]];</span> <span class=\"string\">then</span></span><br><span class=\"line\">        <span class=\"string\">echo</span> <span class=\"string\">'Build Successful.'</span></span><br><span class=\"line\">      <span class=\"string\">else</span></span><br><span class=\"line\">        <span class=\"string\">echo</span> <span class=\"string\">'Build Failed!'</span></span><br><span class=\"line\">        <span class=\"string\">exit</span> <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"string\">fi</span></span><br><span class=\"line\"><span class=\"attr\">    execType:</span> <span class=\"string\">script</span></span><br><span class=\"line\"><span class=\"attr\">  - commandName:</span> <span class=\"string\">pwd</span></span><br><span class=\"line\"><span class=\"attr\">  - Script:</span> <span class=\"string\">ls</span></span><br><span class=\"line\"><span class=\"attr\">    execType:</span> <span class=\"string\">script</span></span><br><span class=\"line\"><span class=\"attr\">  deployData:</span></span><br><span class=\"line\"><span class=\"attr\">    envs:</span> <span class=\"comment\"># deploy</span></span><br><span class=\"line\"><span class=\"attr\">      CODE_TYPE:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">      DOCKER_API_VERSION:</span> <span class=\"string\">\"1.24\"</span> <span class=\"comment\"># docker api 版本号</span></span><br><span class=\"line\"><span class=\"attr\">      MAVEN_MIRROR_URL:</span> <span class=\"attr\">http://nexus.vpclub.cn/repository/maven-public/</span> <span class=\"comment\">#maven仓库地址</span></span><br><span class=\"line\"><span class=\"attr\">    hostPathVolume:</span></span><br><span class=\"line\">      <span class=\"string\">/var/lib/docker:</span> <span class=\"string\">/var/lib/docker</span> <span class=\"comment\">#挂载目录</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/docker.sock:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"number\">8080</span> <span class=\"comment\">#暴露端口</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">    replicas:</span> <span class=\"number\">1</span> <span class=\"comment\"># replicas pod的数量</span></span><br><span class=\"line\"><span class=\"attr\">  dockerAuthConfig:</span></span><br><span class=\"line\"><span class=\"attr\">    password:</span> <span class=\"comment\">#docker鉴权所需要的账号密码</span></span><br><span class=\"line\"><span class=\"attr\">    username:</span> <span class=\"string\">unused</span></span><br><span class=\"line\"><span class=\"attr\">  dockerFile:</span> <span class=\"comment\"># 制作 镜像的 dockerfile</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">FROM</span> <span class=\"string\">clarechu/base-image-java:0.1</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENV</span>  <span class=\"string\">TZ=\"Asia/Shanghai\"</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENV</span>  <span class=\"string\">APP_OPTIONS=\"-Xms128m</span> <span class=\"bullet\">-Xmx512m</span> <span class=\"bullet\">-Xss512k\"</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENV</span>   <span class=\"string\">APP_OPTIONS=\"-Xms128m</span> <span class=\"bullet\">-Xmx512m</span> <span class=\"bullet\">-Xss512k\"</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">USER</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">RUN</span>  <span class=\"string\">useradd</span> <span class=\"bullet\">-u</span> <span class=\"number\">1002</span> <span class=\"bullet\">-r</span> <span class=\"bullet\">-g</span> <span class=\"number\">0</span> <span class=\"bullet\">-d</span> <span class=\"string\">$&#123;HOME&#125;</span> <span class=\"bullet\">-s</span> <span class=\"string\">/sbin/nologin</span> <span class=\"bullet\">-c</span> <span class=\"string\">\"Default Application</span></span><br><span class=\"line\"><span class=\"string\">    User\"</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">COPY</span> <span class=\"string\">./app.jar</span> <span class=\"string\">$&#123;HOME&#125;</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">RUN</span> <span class=\"string\">chown</span> <span class=\"bullet\">-R</span> <span class=\"number\">1001</span><span class=\"string\">:0</span> <span class=\"string\">$&#123;HOME&#125;</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">USER</span> <span class=\"number\">1002</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">EXPOSE</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">EXPOSE</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">ENTRYPOINT</span> <span class=\"string\">[\"sh\",\"-c\",\"java</span> <span class=\"bullet\">-jar</span> <span class=\"string\">$HOME/app.jar</span> <span class=\"string\">$APP_OPTIONS\"]</span></span><br><span class=\"line\"><span class=\"attr\">  dockerRegistry:</span> <span class=\"string\">docker-registry-default.app.vpclub.io</span> <span class=\"comment\">#上传的镜像仓库地址</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span> <span class=\"comment\">#流程</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">createService</span> <span class=\"comment\">#创建 hinode 的service</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">deployNode</span> <span class=\"comment\"># 创建deployment</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">clone</span> <span class=\"comment\"># clone代码</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">compile</span> <span class=\"comment\"># 编译clone下来的代码</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">buildImage</span> <span class=\"comment\"># 编译镜像</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">pushImage</span> <span class=\"comment\"># 推镜像</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">deleteDeployment</span> <span class=\"comment\"># 删除hinode资源 和 service</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  lastVersion:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h1>deploymentconfig 资源</h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DeploymentConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java-test</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  dockerRegistry:</span> <span class=\"string\">docker-registry.default.svc:5000</span></span><br><span class=\"line\"><span class=\"attr\">  env:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">starter</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"string\">jav</span> <span class=\"bullet\">-jar</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">TZ</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"string\">Asia/Shanghai</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">APP_OPTIONS</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"bullet\">-Xms128m</span> <span class=\"bullet\">-Xmx512m</span> <span class=\"bullet\">-Xss512k</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">SPRING_PROFILES_ACTIVE</span></span><br><span class=\"line\"><span class=\"attr\">    value:</span> <span class=\"string\">test</span></span><br><span class=\"line\"><span class=\"attr\">  envType:</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">remoteDeploy</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">deploy</span></span><br><span class=\"line\"><span class=\"attr\">  fromRegistry:</span> <span class=\"string\">docker-registry-default.app.vpclub.io</span></span><br><span class=\"line\"><span class=\"attr\">  port:</span></span><br><span class=\"line\"><span class=\"attr\">  - containerPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">tcp-8080</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">  profile:</span> <span class=\"string\">test</span> <span class=\"comment\">#部署环境</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  lastVersion:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h1>sourceconfig 资源</h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">SourceConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java-source</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  scm:</span></span><br><span class=\"line\"><span class=\"attr\">    apiVersion:</span> <span class=\"string\">v3</span></span><br><span class=\"line\"><span class=\"attr\">    ref:</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    token:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">    url:</span> <span class=\"attr\">http://gitlab.vpclub:8022</span></span><br><span class=\"line\"><span class=\"attr\">  sourceCode:</span></span><br><span class=\"line\"><span class=\"attr\">  - content:</span> <span class=\"string\">&lt;packaging&gt;jar&lt;/packaging&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    path:</span> <span class=\"string\">pom.xml</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  metadata:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n<h1>gatewayconfig 资源</h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">GatewayConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  clusterName:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-26</span><span class=\"attr\">T09:01:51Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  eventType:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"attr\">  hosts:</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span> <span class=\"string\">dev.vpclub.cn</span></span><br><span class=\"line\"><span class=\"attr\">  httpIfTerminated:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  httpsOnly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  kongAdminUrl:</span> <span class=\"attr\">http://kong-admin-kong-dev.app.vpclub.io</span></span><br><span class=\"line\"><span class=\"attr\">  preserveHost:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  profile:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">  retries:</span> <span class=\"string\">\"5\"</span></span><br><span class=\"line\"><span class=\"attr\">  stripUri:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamConnectTimeout:</span> <span class=\"number\">60000</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamReadTimeout:</span> <span class=\"number\">60000</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamSendTimeout:</span> <span class=\"number\">60000</span></span><br><span class=\"line\"><span class=\"attr\">  upstreamUrl:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  uris:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  metadata:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n<h1>serviceconfig 资源</h1>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">mio.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceConfig</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  clusterName:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">  creationTimestamp:</span> <span class=\"number\">2018</span><span class=\"bullet\">-10</span><span class=\"bullet\">-26</span><span class=\"attr\">T07:31:26Z</span></span><br><span class=\"line\"><span class=\"attr\">  generation:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    profile:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">java</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">templates</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">http-8080</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">http-7575</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  metadata:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n"},{"layout":"k8s-doc","title":"回滚部署","catalog":true,"date":"2018-11-10T07:37:24.000Z","subtitle":"回滚到历史版本","header-img":"7vLMRNQ.jpg","_content":"\n#\n\n有时您可能想要回滚部署; 例如，当部署不稳定时，例如崩溃循环。默认情况下，所有Deployment的卷展栏历史记录都保留在系统中，以便您可以随时回滚（可以通过修改修订历史记录限制来更改）。\n\n## 创建多个版本的 POD\n\n镜像版本：\n\n```shell\nREPOSITORY                                                     TAG                 IMAGE ID            CREATED             SIZE\ndocker.vpclub.cn/hidevopsio/hinode-java-jar                    0.1                 bce3d8ba6ba1        5 days ago          728 MB\ndocker.vpclub.cn/hidevopsio/hinode-java-jar                    1.0                 00de2c65d80e        2 weeks ago         761.6 MB\n```\n\n分别是0.1 和 1.0 版本。\n\n## 部署 v1版本的 hello-world\n\n现在 在 namespace 为`demo` 创建 app 为`hello-world`的`pod`， 镜像为`docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1`。\n\n```shell\n# 获取当前的pod\nkubectl get pod -n demo\nNAME                          READY     STATUS    RESTARTS   AGE\nhello-world-bbd694d8b-9pdcs   1/1       Running   0          8m\nhello-world-bbd694d8b-djv2h   1/1       Running   0          8m\n\n# 当pod STATUS为 RUNNING 的时候 pod为成功\n\n```\n\n* 获取pod的详细信息\n\n```shell\nkubectl describe pod hello-world-bbd694d8b-9pdcs -n demo\n```\n\n下面是 pod `hello-world-bbd694d8b-9pdcs`的基本信息，从下面的信息可以得到我们现  demo 组下面运行的pod为镜像名称为：docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1， sha256:`8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab`\n\n```yaml\n\nName:           hello-world-bbd694d8b-9pdcs\nNamespace:      demo\nNode:           k8s-06.k8s.local/172.16.10.46\nStart Time:     Wed, 31 Oct 2018 11:47:20 +0800\nLabels:         app=hello-world\n                pod-template-hash=668250846\nAnnotations:    <none>\nStatus:         Running\nIP:             10.244.0.42\nControlled By:  ReplicaSet/hello-world-bbd694d8b\nContainers:\n  hello-world:\n    Container ID:   docker://5e4043acbe18304bd6c3b326ed3fc044b3cb4ec6f54f2a27e7254e5782bf406a\n    Image:          docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\n    Image ID:       docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab\n    Port:           80/TCP\n    State:          Running\n      Started:      Wed, 31 Oct 2018 11:47:47 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dgqj2 (ro)\nConditions:\n  Type           Status\n  Initialized    True\n  Ready          True\n  PodScheduled   True\nVolumes:\n  default-token-dgqj2:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-dgqj2\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason                 Age   From                       Message\n  ----    ------                 ----  ----                       -------\n  Normal  Scheduled              14m   default-scheduler          Successfully assigned hello-world-bbd694d8b-9pdcs to k8s-06.k8s.local\n  Normal  SuccessfulMountVolume  14m   kubelet, k8s-06.k8s.local  MountVolume.SetUp succeeded for volume \"default-token-dgqj2\"\n  Normal  Pulling                14m   kubelet, k8s-06.k8s.local  pulling image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Pulled                 14m   kubelet, k8s-06.k8s.local  Successfully pulled image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Created                14m   kubelet, k8s-06.k8s.local  Created container\n  Normal  Started                14m   kubelet, k8s-06.k8s.local  Started container\n```\n\n## 部署v2版本的hello-world\n\n方法如上：\n\n获取v2版本的详细信息\n\n```shell\n\nkubectl get pod -n demo\n\nNAME                           READY     STATUS    RESTARTS   AGE\nhello-world-75d9cb465d-79vl8   1/1       Running   0          2m\nhello-world-75d9cb465d-rbv2g   1/1       Running   0          2m\n```\n\n```shell\n##获取pod的详细信息\nkubectl describe pod hello-world-75d9cb465d-79vl8 -n demo\n该pod的版本为 docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\nsha256 ：c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166\n```\n\n如下：\n\n```yaml\nName:           hello-world-75d9cb465d-79vl8\nNamespace:      demo\nNode:           k8s-04.k8s.local/172.16.10.44\nStart Time:     Wed, 31 Oct 2018 12:57:52 +0800\nLabels:         app=hello-world\n                pod-template-hash=3185760218\nAnnotations:    <none>\nStatus:         Running\nIP:             10.244.2.43\nControlled By:  ReplicaSet/hello-world-75d9cb465d\nContainers:\n  hello-world:\n    Container ID:   docker://4a115dff91073e151c41e6a3b5fd4a6e514afb8853accc76b0678a669af81c65\n    Image:          docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\n    Image ID:       docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166\n    Port:           80/TCP\n    State:          Running\n      Started:      Wed, 31 Oct 2018 13:00:21 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dgqj2 (ro)\nConditions:\n  Type           Status\n  Initialized    True\n  Ready          True\n  PodScheduled   True\nVolumes:\n  default-token-dgqj2:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-dgqj2\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason                 Age   From                       Message\n  ----    ------                 ----  ----                       -------\n  Normal  Scheduled              2m    default-scheduler          Successfully assigned hello-world-75d9cb465d-79vl8 to k8s-04.k8s.local\n  Normal  SuccessfulMountVolume  2m    kubelet, k8s-04.k8s.local  MountVolume.SetUp succeeded for volume \"default-token-dgqj2\"\n  Normal  Pulling                2m    kubelet, k8s-04.k8s.local  pulling image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"\n  Normal  Pulled                 15s   kubelet, k8s-04.k8s.local  Successfully pulled image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"\n  Normal  Created                13s   kubelet, k8s-04.k8s.local  Created container\n  Normal  Started                12s   kubelet, k8s-04.k8s.local  Started container\n```\n\n* 由详细信息可以看出该pod已经为最新的pod\n\n现在我们需要回退到0.1版本 镜像那么我们怎么处理呢？\n\n### 检查部署的部署历史记录\n\n首先，检查此部署的修订版：\n\n```shell\nkubectl rollout history deployment/hello-world -n demo\n\n## REVISION 为 deployment/hello-world 所有版本。\n\n## CHANGE-CAUSE 为版本的注释\n\ndeployments \"hello-world\"\nREVISION  CHANGE-CAUSE\n1         <none>\n2         <none>\n3         <none>\n\n如果查看到的结果为None，则需要在创建和更新deployment时加上 --record参数.\n\n```\n\n修改注释\n\n```shell\nkubectl annotate deployment/hello-world kubernetes.io/change-cause=\"image 1.0\" -n demo --revision=3\n```\n\n要进一步查看每个修订的详细信息，请运行：\n\n```shell\nkubectl rollout history deployment/hello-world -n demo --revision=2\n```\n\n## 回滚到以前的版本\n\n现在您已决定撤消当前的卷展栏并回滚到以前的版本：\n\n```shell\nkubectl rollout undo deployment/hello-world -n demo\n\n```\n\n执行成功后pod会重新启动\n\n```shell\nkubectl get pod -n demo\nNAME                           READY     STATUS              RESTARTS   AGE\nhello-world-75d9cb465d-rbv2g   1/1       Running             0          21m\nhello-world-bbd694d8b-gfh6x    1/1       Running             0          19s\nhello-world-bbd694d8b-lvw88    0/1       ContainerCreating   0          18s\n```\n\n获取pod的相信信息, 由下面的例子我们可以看出镜像已经回退到上一个版本的 `docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1` sha256 : `8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab`\n\n```yaml\nName:           hello-world-bbd694d8b-gfh6x\nNamespace:      demo\nNode:           k8s-06.k8s.local/172.16.10.46\nStart Time:     Wed, 31 Oct 2018 13:19:30 +0800\nLabels:         app=hello-world\n                pod-template-hash=668250846\nAnnotations:    <none>\nStatus:         Running\nIP:             10.244.0.43\nControlled By:  ReplicaSet/hello-world-bbd694d8b\nContainers:\n  hello-world:\n    Container ID:   docker://b88bcf11ef2c5439511f457baf29c0724d19dca1db7dbb560f7d13a475e1cf1d\n    Image:          docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\n    Image ID:       docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab\n    Port:           80/TCP\n    State:          Running\n      Started:      Wed, 31 Oct 2018 13:19:48 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dgqj2 (ro)\nConditions:\n  Type           Status\n  Initialized    True\n  Ready          True\n  PodScheduled   True\nVolumes:\n  default-token-dgqj2:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-dgqj2\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason                 Age   From                       Message\n  ----    ------                 ----  ----                       -------\n  Normal  Scheduled              2m    default-scheduler          Successfully assigned hello-world-bbd694d8b-gfh6x to k8s-06.k8s.local\n  Normal  SuccessfulMountVolume  2m    kubelet, k8s-06.k8s.local  MountVolume.SetUp succeeded for volume \"default-token-dgqj2\"\n  Normal  Pulling                2m    kubelet, k8s-06.k8s.local  pulling image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Pulled                 2m    kubelet, k8s-06.k8s.local  Successfully pulled image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Created                2m    kubelet, k8s-06.k8s.local  Created container\n  Normal  Started                2m    kubelet, k8s-06.k8s.local  Started container\n```\n\n或者，您可以通过在--to-revision以下位置指定回滚到特定修订：\n\n```shell\nkubectl rollout undo deployment/hello-world -n demo --to-revision=2\n```\n\n### 暂停和恢复部署\n\n刚刚创建的部署, 使用该命令暂停：\n\n```shell\nkubectl rollout pause deployment\\hello-world -n demo\n```\n\n暂停之前部署的初始状态将继续其功能，但只要部署暂停，部署的新更新将不会产生任何影响。\n\n最后，恢复部署并观察一个新的ReplicaSet，提供所有新的更新：\n\n```shell\nkubectl rollout resume deployment/helo-world -n demo","source":"_posts/deployment.md","raw":"---\nlayout: k8s-doc\ntitle: 回滚部署\ncatalog: true\ndate: 2018-11-10 15:37:24\ntags: \n- k8s\n- deployment\nsubtitle: \"回滚到历史版本\"\nheader-img: \"7vLMRNQ.jpg\"\n---\n\n#\n\n有时您可能想要回滚部署; 例如，当部署不稳定时，例如崩溃循环。默认情况下，所有Deployment的卷展栏历史记录都保留在系统中，以便您可以随时回滚（可以通过修改修订历史记录限制来更改）。\n\n## 创建多个版本的 POD\n\n镜像版本：\n\n```shell\nREPOSITORY                                                     TAG                 IMAGE ID            CREATED             SIZE\ndocker.vpclub.cn/hidevopsio/hinode-java-jar                    0.1                 bce3d8ba6ba1        5 days ago          728 MB\ndocker.vpclub.cn/hidevopsio/hinode-java-jar                    1.0                 00de2c65d80e        2 weeks ago         761.6 MB\n```\n\n分别是0.1 和 1.0 版本。\n\n## 部署 v1版本的 hello-world\n\n现在 在 namespace 为`demo` 创建 app 为`hello-world`的`pod`， 镜像为`docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1`。\n\n```shell\n# 获取当前的pod\nkubectl get pod -n demo\nNAME                          READY     STATUS    RESTARTS   AGE\nhello-world-bbd694d8b-9pdcs   1/1       Running   0          8m\nhello-world-bbd694d8b-djv2h   1/1       Running   0          8m\n\n# 当pod STATUS为 RUNNING 的时候 pod为成功\n\n```\n\n* 获取pod的详细信息\n\n```shell\nkubectl describe pod hello-world-bbd694d8b-9pdcs -n demo\n```\n\n下面是 pod `hello-world-bbd694d8b-9pdcs`的基本信息，从下面的信息可以得到我们现  demo 组下面运行的pod为镜像名称为：docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1， sha256:`8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab`\n\n```yaml\n\nName:           hello-world-bbd694d8b-9pdcs\nNamespace:      demo\nNode:           k8s-06.k8s.local/172.16.10.46\nStart Time:     Wed, 31 Oct 2018 11:47:20 +0800\nLabels:         app=hello-world\n                pod-template-hash=668250846\nAnnotations:    <none>\nStatus:         Running\nIP:             10.244.0.42\nControlled By:  ReplicaSet/hello-world-bbd694d8b\nContainers:\n  hello-world:\n    Container ID:   docker://5e4043acbe18304bd6c3b326ed3fc044b3cb4ec6f54f2a27e7254e5782bf406a\n    Image:          docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\n    Image ID:       docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab\n    Port:           80/TCP\n    State:          Running\n      Started:      Wed, 31 Oct 2018 11:47:47 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dgqj2 (ro)\nConditions:\n  Type           Status\n  Initialized    True\n  Ready          True\n  PodScheduled   True\nVolumes:\n  default-token-dgqj2:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-dgqj2\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason                 Age   From                       Message\n  ----    ------                 ----  ----                       -------\n  Normal  Scheduled              14m   default-scheduler          Successfully assigned hello-world-bbd694d8b-9pdcs to k8s-06.k8s.local\n  Normal  SuccessfulMountVolume  14m   kubelet, k8s-06.k8s.local  MountVolume.SetUp succeeded for volume \"default-token-dgqj2\"\n  Normal  Pulling                14m   kubelet, k8s-06.k8s.local  pulling image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Pulled                 14m   kubelet, k8s-06.k8s.local  Successfully pulled image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Created                14m   kubelet, k8s-06.k8s.local  Created container\n  Normal  Started                14m   kubelet, k8s-06.k8s.local  Started container\n```\n\n## 部署v2版本的hello-world\n\n方法如上：\n\n获取v2版本的详细信息\n\n```shell\n\nkubectl get pod -n demo\n\nNAME                           READY     STATUS    RESTARTS   AGE\nhello-world-75d9cb465d-79vl8   1/1       Running   0          2m\nhello-world-75d9cb465d-rbv2g   1/1       Running   0          2m\n```\n\n```shell\n##获取pod的详细信息\nkubectl describe pod hello-world-75d9cb465d-79vl8 -n demo\n该pod的版本为 docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\nsha256 ：c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166\n```\n\n如下：\n\n```yaml\nName:           hello-world-75d9cb465d-79vl8\nNamespace:      demo\nNode:           k8s-04.k8s.local/172.16.10.44\nStart Time:     Wed, 31 Oct 2018 12:57:52 +0800\nLabels:         app=hello-world\n                pod-template-hash=3185760218\nAnnotations:    <none>\nStatus:         Running\nIP:             10.244.2.43\nControlled By:  ReplicaSet/hello-world-75d9cb465d\nContainers:\n  hello-world:\n    Container ID:   docker://4a115dff91073e151c41e6a3b5fd4a6e514afb8853accc76b0678a669af81c65\n    Image:          docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\n    Image ID:       docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166\n    Port:           80/TCP\n    State:          Running\n      Started:      Wed, 31 Oct 2018 13:00:21 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dgqj2 (ro)\nConditions:\n  Type           Status\n  Initialized    True\n  Ready          True\n  PodScheduled   True\nVolumes:\n  default-token-dgqj2:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-dgqj2\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason                 Age   From                       Message\n  ----    ------                 ----  ----                       -------\n  Normal  Scheduled              2m    default-scheduler          Successfully assigned hello-world-75d9cb465d-79vl8 to k8s-04.k8s.local\n  Normal  SuccessfulMountVolume  2m    kubelet, k8s-04.k8s.local  MountVolume.SetUp succeeded for volume \"default-token-dgqj2\"\n  Normal  Pulling                2m    kubelet, k8s-04.k8s.local  pulling image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"\n  Normal  Pulled                 15s   kubelet, k8s-04.k8s.local  Successfully pulled image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"\n  Normal  Created                13s   kubelet, k8s-04.k8s.local  Created container\n  Normal  Started                12s   kubelet, k8s-04.k8s.local  Started container\n```\n\n* 由详细信息可以看出该pod已经为最新的pod\n\n现在我们需要回退到0.1版本 镜像那么我们怎么处理呢？\n\n### 检查部署的部署历史记录\n\n首先，检查此部署的修订版：\n\n```shell\nkubectl rollout history deployment/hello-world -n demo\n\n## REVISION 为 deployment/hello-world 所有版本。\n\n## CHANGE-CAUSE 为版本的注释\n\ndeployments \"hello-world\"\nREVISION  CHANGE-CAUSE\n1         <none>\n2         <none>\n3         <none>\n\n如果查看到的结果为None，则需要在创建和更新deployment时加上 --record参数.\n\n```\n\n修改注释\n\n```shell\nkubectl annotate deployment/hello-world kubernetes.io/change-cause=\"image 1.0\" -n demo --revision=3\n```\n\n要进一步查看每个修订的详细信息，请运行：\n\n```shell\nkubectl rollout history deployment/hello-world -n demo --revision=2\n```\n\n## 回滚到以前的版本\n\n现在您已决定撤消当前的卷展栏并回滚到以前的版本：\n\n```shell\nkubectl rollout undo deployment/hello-world -n demo\n\n```\n\n执行成功后pod会重新启动\n\n```shell\nkubectl get pod -n demo\nNAME                           READY     STATUS              RESTARTS   AGE\nhello-world-75d9cb465d-rbv2g   1/1       Running             0          21m\nhello-world-bbd694d8b-gfh6x    1/1       Running             0          19s\nhello-world-bbd694d8b-lvw88    0/1       ContainerCreating   0          18s\n```\n\n获取pod的相信信息, 由下面的例子我们可以看出镜像已经回退到上一个版本的 `docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1` sha256 : `8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab`\n\n```yaml\nName:           hello-world-bbd694d8b-gfh6x\nNamespace:      demo\nNode:           k8s-06.k8s.local/172.16.10.46\nStart Time:     Wed, 31 Oct 2018 13:19:30 +0800\nLabels:         app=hello-world\n                pod-template-hash=668250846\nAnnotations:    <none>\nStatus:         Running\nIP:             10.244.0.43\nControlled By:  ReplicaSet/hello-world-bbd694d8b\nContainers:\n  hello-world:\n    Container ID:   docker://b88bcf11ef2c5439511f457baf29c0724d19dca1db7dbb560f7d13a475e1cf1d\n    Image:          docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\n    Image ID:       docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab\n    Port:           80/TCP\n    State:          Running\n      Started:      Wed, 31 Oct 2018 13:19:48 +0800\n    Ready:          True\n    Restart Count:  0\n    Environment:    <none>\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dgqj2 (ro)\nConditions:\n  Type           Status\n  Initialized    True\n  Ready          True\n  PodScheduled   True\nVolumes:\n  default-token-dgqj2:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  default-token-dgqj2\n    Optional:    false\nQoS Class:       BestEffort\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\n                 node.kubernetes.io/unreachable:NoExecute for 300s\nEvents:\n  Type    Reason                 Age   From                       Message\n  ----    ------                 ----  ----                       -------\n  Normal  Scheduled              2m    default-scheduler          Successfully assigned hello-world-bbd694d8b-gfh6x to k8s-06.k8s.local\n  Normal  SuccessfulMountVolume  2m    kubelet, k8s-06.k8s.local  MountVolume.SetUp succeeded for volume \"default-token-dgqj2\"\n  Normal  Pulling                2m    kubelet, k8s-06.k8s.local  pulling image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Pulled                 2m    kubelet, k8s-06.k8s.local  Successfully pulled image \"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"\n  Normal  Created                2m    kubelet, k8s-06.k8s.local  Created container\n  Normal  Started                2m    kubelet, k8s-06.k8s.local  Started container\n```\n\n或者，您可以通过在--to-revision以下位置指定回滚到特定修订：\n\n```shell\nkubectl rollout undo deployment/hello-world -n demo --to-revision=2\n```\n\n### 暂停和恢复部署\n\n刚刚创建的部署, 使用该命令暂停：\n\n```shell\nkubectl rollout pause deployment\\hello-world -n demo\n```\n\n暂停之前部署的初始状态将继续其功能，但只要部署暂停，部署的新更新将不会产生任何影响。\n\n最后，恢复部署并观察一个新的ReplicaSet，提供所有新的更新：\n\n```shell\nkubectl rollout resume deployment/helo-world -n demo","slug":"deployment","published":1,"updated":"2018-11-10T08:04:25.527Z","comments":1,"photos":[],"link":"","_id":"cjoofzuva0005ttjr60ctc38b","content":"<h1><span id=\"\"></span></h1>\n<p>有时您可能想要回滚部署; 例如，当部署不稳定时，例如崩溃循环。默认情况下，所有Deployment的卷展栏历史记录都保留在系统中，以便您可以随时回滚（可以通过修改修订历史记录限制来更改）。</p>\n<h2><span id=\"创建多个版本的-pod\">创建多个版本的 POD</span></h2>\n<p>镜像版本：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REPOSITORY                                                     TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">docker.vpclub.cn/hidevopsio/hinode-java-jar                    0.1                 bce3d8ba6ba1        5 days ago          728 MB</span><br><span class=\"line\">docker.vpclub.cn/hidevopsio/hinode-java-jar                    1.0                 00de2c65d80e        2 weeks ago         761.6 MB</span><br></pre></td></tr></table></figure>\n<p>分别是0.1 和 1.0 版本。</p>\n<h2><span id=\"部署-v1版本的-hello-world\">部署 v1版本的 hello-world</span></h2>\n<p>现在 在 namespace 为<code>demo</code> 创建 app 为<code>hello-world</code>的<code>pod</code>， 镜像为<code>docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 获取当前的pod</span></span><br><span class=\"line\">kubectl get pod -n demo</span><br><span class=\"line\">NAME                          READY     STATUS    RESTARTS   AGE</span><br><span class=\"line\">hello-world-bbd694d8b-9pdcs   1/1       Running   0          8m</span><br><span class=\"line\">hello-world-bbd694d8b-djv2h   1/1       Running   0          8m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 当pod STATUS为 RUNNING 的时候 pod为成功</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>获取pod的详细信息</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe pod hello-world-bbd694d8b-9pdcs -n demo</span><br></pre></td></tr></table></figure>\n<p>下面是 pod <code>hello-world-bbd694d8b-9pdcs</code>的基本信息，从下面的信息可以得到我们现  demo 组下面运行的pod为镜像名称为：<a href=\"http://docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1%EF%BC%8C\" target=\"_blank\" rel=\"noopener\">docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1，</a> sha256:<code>8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Name:</span>           <span class=\"string\">hello-world-bbd694d8b-9pdcs</span></span><br><span class=\"line\"><span class=\"attr\">Namespace:</span>      <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">Node:</span>           <span class=\"string\">k8s-06.k8s.local/172.16.10.46</span></span><br><span class=\"line\"><span class=\"string\">Start</span> <span class=\"attr\">Time:</span>     <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">11</span><span class=\"string\">:47:20</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">Labels:</span>         <span class=\"string\">app=hello-world</span></span><br><span class=\"line\">                <span class=\"string\">pod-template-hash=668250846</span></span><br><span class=\"line\"><span class=\"attr\">Annotations:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Status:</span>         <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">IP:</span>             <span class=\"number\">10.244</span><span class=\"number\">.0</span><span class=\"number\">.42</span></span><br><span class=\"line\"><span class=\"string\">Controlled</span> <span class=\"attr\">By:</span>  <span class=\"string\">ReplicaSet/hello-world-bbd694d8b</span></span><br><span class=\"line\"><span class=\"attr\">Containers:</span></span><br><span class=\"line\"><span class=\"attr\">  hello-world:</span></span><br><span class=\"line\">    <span class=\"string\">Container</span> <span class=\"attr\">ID:</span>   <span class=\"attr\">docker://5e4043acbe18304bd6c3b326ed3fc044b3cb4ec6f54f2a27e7254e5782bf406a</span></span><br><span class=\"line\"><span class=\"attr\">    Image:</span>          <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</span></span><br><span class=\"line\">    <span class=\"string\">Image</span> <span class=\"attr\">ID:</span>       <span class=\"attr\">docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</span></span><br><span class=\"line\"><span class=\"attr\">    Port:</span>           <span class=\"number\">80</span><span class=\"string\">/TCP</span></span><br><span class=\"line\"><span class=\"attr\">    State:</span>          <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">      Started:</span>      <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">11</span><span class=\"string\">:47:47</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">    Ready:</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"string\">Restart</span> <span class=\"attr\">Count:</span>  <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">    Environment:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    Mounts:</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/secrets/kubernetes.io/serviceaccount</span> <span class=\"string\">from</span> <span class=\"string\">default-token-dgqj2</span> <span class=\"string\">(ro)</span></span><br><span class=\"line\"><span class=\"attr\">Conditions:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>           <span class=\"string\">Status</span></span><br><span class=\"line\">  <span class=\"string\">Initialized</span>    <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">Ready</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">PodScheduled</span>   <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"attr\">Volumes:</span></span><br><span class=\"line\"><span class=\"attr\">  default-token-dgqj2:</span></span><br><span class=\"line\"><span class=\"attr\">    Type:</span>        <span class=\"string\">Secret</span> <span class=\"string\">(a</span> <span class=\"string\">volume</span> <span class=\"string\">populated</span> <span class=\"string\">by</span> <span class=\"string\">a</span> <span class=\"string\">Secret)</span></span><br><span class=\"line\"><span class=\"attr\">    SecretName:</span>  <span class=\"string\">default-token-dgqj2</span></span><br><span class=\"line\"><span class=\"attr\">    Optional:</span>    <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"string\">QoS</span> <span class=\"attr\">Class:</span>       <span class=\"string\">BestEffort</span></span><br><span class=\"line\"><span class=\"attr\">Node-Selectors:</span>  <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Tolerations:</span>     <span class=\"string\">node.kubernetes.io/not-ready:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\">                 <span class=\"string\">node.kubernetes.io/unreachable:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\"><span class=\"attr\">Events:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>    <span class=\"string\">Reason</span>                 <span class=\"string\">Age</span>   <span class=\"string\">From</span>                       <span class=\"string\">Message</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span><span class=\"meta\">---</span>    <span class=\"bullet\">------</span>                 <span class=\"bullet\">----</span>  <span class=\"bullet\">----</span>                       <span class=\"bullet\">-------</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Scheduled</span>              <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">default-scheduler</span>          <span class=\"string\">Successfully</span> <span class=\"string\">assigned</span> <span class=\"string\">hello-world-bbd694d8b-9pdcs</span> <span class=\"string\">to</span> <span class=\"string\">k8s-06.k8s.local</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">SuccessfulMountVolume</span>  <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">MountVolume.SetUp</span> <span class=\"string\">succeeded</span> <span class=\"string\">for</span> <span class=\"string\">volume</span> <span class=\"string\">\"default-token-dgqj2\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulling</span>                <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">pulling</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulled</span>                 <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Successfully</span> <span class=\"string\">pulled</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Created</span>                <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Created</span> <span class=\"string\">container</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Started</span>                <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Started</span> <span class=\"string\">container</span></span><br></pre></td></tr></table></figure>\n<h2><span id=\"部署v2版本的hello-world\">部署v2版本的hello-world</span></h2>\n<p>方法如上：</p>\n<p>获取v2版本的详细信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">kubectl get pod -n demo</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                           READY     STATUS    RESTARTS   AGE</span><br><span class=\"line\">hello-world-75d9cb465d-79vl8   1/1       Running   0          2m</span><br><span class=\"line\">hello-world-75d9cb465d-rbv2g   1/1       Running   0          2m</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">#获取pod的详细信息</span></span></span><br><span class=\"line\">kubectl describe pod hello-world-75d9cb465d-79vl8 -n demo</span><br><span class=\"line\">该pod的版本为 docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0</span><br><span class=\"line\">sha256 ：c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166</span><br></pre></td></tr></table></figure>\n<p>如下：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Name:</span>           <span class=\"string\">hello-world-75d9cb465d-79vl8</span></span><br><span class=\"line\"><span class=\"attr\">Namespace:</span>      <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">Node:</span>           <span class=\"string\">k8s-04.k8s.local/172.16.10.44</span></span><br><span class=\"line\"><span class=\"string\">Start</span> <span class=\"attr\">Time:</span>     <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">12</span><span class=\"string\">:57:52</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">Labels:</span>         <span class=\"string\">app=hello-world</span></span><br><span class=\"line\">                <span class=\"string\">pod-template-hash=3185760218</span></span><br><span class=\"line\"><span class=\"attr\">Annotations:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Status:</span>         <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">IP:</span>             <span class=\"number\">10.244</span><span class=\"number\">.2</span><span class=\"number\">.43</span></span><br><span class=\"line\"><span class=\"string\">Controlled</span> <span class=\"attr\">By:</span>  <span class=\"string\">ReplicaSet/hello-world-75d9cb465d</span></span><br><span class=\"line\"><span class=\"attr\">Containers:</span></span><br><span class=\"line\"><span class=\"attr\">  hello-world:</span></span><br><span class=\"line\">    <span class=\"string\">Container</span> <span class=\"attr\">ID:</span>   <span class=\"attr\">docker://4a115dff91073e151c41e6a3b5fd4a6e514afb8853accc76b0678a669af81c65</span></span><br><span class=\"line\"><span class=\"attr\">    Image:</span>          <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0</span></span><br><span class=\"line\">    <span class=\"string\">Image</span> <span class=\"attr\">ID:</span>       <span class=\"attr\">docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166</span></span><br><span class=\"line\"><span class=\"attr\">    Port:</span>           <span class=\"number\">80</span><span class=\"string\">/TCP</span></span><br><span class=\"line\"><span class=\"attr\">    State:</span>          <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">      Started:</span>      <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">13</span><span class=\"string\">:00:21</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">    Ready:</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"string\">Restart</span> <span class=\"attr\">Count:</span>  <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">    Environment:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    Mounts:</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/secrets/kubernetes.io/serviceaccount</span> <span class=\"string\">from</span> <span class=\"string\">default-token-dgqj2</span> <span class=\"string\">(ro)</span></span><br><span class=\"line\"><span class=\"attr\">Conditions:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>           <span class=\"string\">Status</span></span><br><span class=\"line\">  <span class=\"string\">Initialized</span>    <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">Ready</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">PodScheduled</span>   <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"attr\">Volumes:</span></span><br><span class=\"line\"><span class=\"attr\">  default-token-dgqj2:</span></span><br><span class=\"line\"><span class=\"attr\">    Type:</span>        <span class=\"string\">Secret</span> <span class=\"string\">(a</span> <span class=\"string\">volume</span> <span class=\"string\">populated</span> <span class=\"string\">by</span> <span class=\"string\">a</span> <span class=\"string\">Secret)</span></span><br><span class=\"line\"><span class=\"attr\">    SecretName:</span>  <span class=\"string\">default-token-dgqj2</span></span><br><span class=\"line\"><span class=\"attr\">    Optional:</span>    <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"string\">QoS</span> <span class=\"attr\">Class:</span>       <span class=\"string\">BestEffort</span></span><br><span class=\"line\"><span class=\"attr\">Node-Selectors:</span>  <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Tolerations:</span>     <span class=\"string\">node.kubernetes.io/not-ready:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\">                 <span class=\"string\">node.kubernetes.io/unreachable:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\"><span class=\"attr\">Events:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>    <span class=\"string\">Reason</span>                 <span class=\"string\">Age</span>   <span class=\"string\">From</span>                       <span class=\"string\">Message</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span><span class=\"meta\">---</span>    <span class=\"bullet\">------</span>                 <span class=\"bullet\">----</span>  <span class=\"bullet\">----</span>                       <span class=\"bullet\">-------</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Scheduled</span>              <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">default-scheduler</span>          <span class=\"string\">Successfully</span> <span class=\"string\">assigned</span> <span class=\"string\">hello-world-75d9cb465d-79vl8</span> <span class=\"string\">to</span> <span class=\"string\">k8s-04.k8s.local</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">SuccessfulMountVolume</span>  <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">MountVolume.SetUp</span> <span class=\"string\">succeeded</span> <span class=\"string\">for</span> <span class=\"string\">volume</span> <span class=\"string\">\"default-token-dgqj2\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulling</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">pulling</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulled</span>                 <span class=\"number\">15</span><span class=\"string\">s</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">Successfully</span> <span class=\"string\">pulled</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Created</span>                <span class=\"number\">13</span><span class=\"string\">s</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">Created</span> <span class=\"string\">container</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Started</span>                <span class=\"number\">12</span><span class=\"string\">s</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">Started</span> <span class=\"string\">container</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>由详细信息可以看出该pod已经为最新的pod</li>\n</ul>\n<p>现在我们需要回退到0.1版本 镜像那么我们怎么处理呢？</p>\n<h3><span id=\"检查部署的部署历史记录\">检查部署的部署历史记录</span></h3>\n<p>首先，检查此部署的修订版：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout history deployment/hello-world -n demo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># REVISION 为 deployment/hello-world 所有版本。</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># CHANGE-CAUSE 为版本的注释</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">deployments \"hello-world\"</span><br><span class=\"line\">REVISION  CHANGE-CAUSE</span><br><span class=\"line\">1         &lt;none&gt;</span><br><span class=\"line\">2         &lt;none&gt;</span><br><span class=\"line\">3         &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">如果查看到的结果为None，则需要在创建和更新deployment时加上 --record参数.</span><br></pre></td></tr></table></figure>\n<p>修改注释</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl annotate deployment/hello-world kubernetes.io/change-cause=\"image 1.0\" -n demo --revision=3</span><br></pre></td></tr></table></figure>\n<p>要进一步查看每个修订的详细信息，请运行：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout history deployment/hello-world -n demo --revision=2</span><br></pre></td></tr></table></figure>\n<h2><span id=\"回滚到以前的版本\">回滚到以前的版本</span></h2>\n<p>现在您已决定撤消当前的卷展栏并回滚到以前的版本：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout undo deployment/hello-world -n demo</span><br></pre></td></tr></table></figure>\n<p>执行成功后pod会重新启动</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n demo</span><br><span class=\"line\">NAME                           READY     STATUS              RESTARTS   AGE</span><br><span class=\"line\">hello-world-75d9cb465d-rbv2g   1/1       Running             0          21m</span><br><span class=\"line\">hello-world-bbd694d8b-gfh6x    1/1       Running             0          19s</span><br><span class=\"line\">hello-world-bbd694d8b-lvw88    0/1       ContainerCreating   0          18s</span><br></pre></td></tr></table></figure>\n<p>获取pod的相信信息, 由下面的例子我们可以看出镜像已经回退到上一个版本的 <code>docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</code> sha256 : <code>8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Name:</span>           <span class=\"string\">hello-world-bbd694d8b-gfh6x</span></span><br><span class=\"line\"><span class=\"attr\">Namespace:</span>      <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">Node:</span>           <span class=\"string\">k8s-06.k8s.local/172.16.10.46</span></span><br><span class=\"line\"><span class=\"string\">Start</span> <span class=\"attr\">Time:</span>     <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">13</span><span class=\"string\">:19:30</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">Labels:</span>         <span class=\"string\">app=hello-world</span></span><br><span class=\"line\">                <span class=\"string\">pod-template-hash=668250846</span></span><br><span class=\"line\"><span class=\"attr\">Annotations:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Status:</span>         <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">IP:</span>             <span class=\"number\">10.244</span><span class=\"number\">.0</span><span class=\"number\">.43</span></span><br><span class=\"line\"><span class=\"string\">Controlled</span> <span class=\"attr\">By:</span>  <span class=\"string\">ReplicaSet/hello-world-bbd694d8b</span></span><br><span class=\"line\"><span class=\"attr\">Containers:</span></span><br><span class=\"line\"><span class=\"attr\">  hello-world:</span></span><br><span class=\"line\">    <span class=\"string\">Container</span> <span class=\"attr\">ID:</span>   <span class=\"attr\">docker://b88bcf11ef2c5439511f457baf29c0724d19dca1db7dbb560f7d13a475e1cf1d</span></span><br><span class=\"line\"><span class=\"attr\">    Image:</span>          <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</span></span><br><span class=\"line\">    <span class=\"string\">Image</span> <span class=\"attr\">ID:</span>       <span class=\"attr\">docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</span></span><br><span class=\"line\"><span class=\"attr\">    Port:</span>           <span class=\"number\">80</span><span class=\"string\">/TCP</span></span><br><span class=\"line\"><span class=\"attr\">    State:</span>          <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">      Started:</span>      <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">13</span><span class=\"string\">:19:48</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">    Ready:</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"string\">Restart</span> <span class=\"attr\">Count:</span>  <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">    Environment:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    Mounts:</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/secrets/kubernetes.io/serviceaccount</span> <span class=\"string\">from</span> <span class=\"string\">default-token-dgqj2</span> <span class=\"string\">(ro)</span></span><br><span class=\"line\"><span class=\"attr\">Conditions:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>           <span class=\"string\">Status</span></span><br><span class=\"line\">  <span class=\"string\">Initialized</span>    <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">Ready</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">PodScheduled</span>   <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"attr\">Volumes:</span></span><br><span class=\"line\"><span class=\"attr\">  default-token-dgqj2:</span></span><br><span class=\"line\"><span class=\"attr\">    Type:</span>        <span class=\"string\">Secret</span> <span class=\"string\">(a</span> <span class=\"string\">volume</span> <span class=\"string\">populated</span> <span class=\"string\">by</span> <span class=\"string\">a</span> <span class=\"string\">Secret)</span></span><br><span class=\"line\"><span class=\"attr\">    SecretName:</span>  <span class=\"string\">default-token-dgqj2</span></span><br><span class=\"line\"><span class=\"attr\">    Optional:</span>    <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"string\">QoS</span> <span class=\"attr\">Class:</span>       <span class=\"string\">BestEffort</span></span><br><span class=\"line\"><span class=\"attr\">Node-Selectors:</span>  <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Tolerations:</span>     <span class=\"string\">node.kubernetes.io/not-ready:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\">                 <span class=\"string\">node.kubernetes.io/unreachable:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\"><span class=\"attr\">Events:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>    <span class=\"string\">Reason</span>                 <span class=\"string\">Age</span>   <span class=\"string\">From</span>                       <span class=\"string\">Message</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span><span class=\"meta\">---</span>    <span class=\"bullet\">------</span>                 <span class=\"bullet\">----</span>  <span class=\"bullet\">----</span>                       <span class=\"bullet\">-------</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Scheduled</span>              <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">default-scheduler</span>          <span class=\"string\">Successfully</span> <span class=\"string\">assigned</span> <span class=\"string\">hello-world-bbd694d8b-gfh6x</span> <span class=\"string\">to</span> <span class=\"string\">k8s-06.k8s.local</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">SuccessfulMountVolume</span>  <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">MountVolume.SetUp</span> <span class=\"string\">succeeded</span> <span class=\"string\">for</span> <span class=\"string\">volume</span> <span class=\"string\">\"default-token-dgqj2\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulling</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">pulling</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulled</span>                 <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Successfully</span> <span class=\"string\">pulled</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Created</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Created</span> <span class=\"string\">container</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Started</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Started</span> <span class=\"string\">container</span></span><br></pre></td></tr></table></figure>\n<p>或者，您可以通过在–to-revision以下位置指定回滚到特定修订：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout undo deployment/hello-world -n demo --to-revision=2</span><br></pre></td></tr></table></figure>\n<h3><span id=\"暂停和恢复部署\">暂停和恢复部署</span></h3>\n<p>刚刚创建的部署, 使用该命令暂停：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout pause deployment\\hello-world -n demo</span><br></pre></td></tr></table></figure>\n<p>暂停之前部署的初始状态将继续其功能，但只要部署暂停，部署的新更新将不会产生任何影响。</p>\n<p>最后，恢复部署并观察一个新的ReplicaSet，提供所有新的更新：</p>\n<pre><code class=\"language-shell\">kubectl rollout resume deployment/helo-world -n demo</code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h1></h1>\n<p>有时您可能想要回滚部署; 例如，当部署不稳定时，例如崩溃循环。默认情况下，所有Deployment的卷展栏历史记录都保留在系统中，以便您可以随时回滚（可以通过修改修订历史记录限制来更改）。</p>\n<h2>创建多个版本的 POD</h2>\n<p>镜像版本：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REPOSITORY                                                     TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">docker.vpclub.cn/hidevopsio/hinode-java-jar                    0.1                 bce3d8ba6ba1        5 days ago          728 MB</span><br><span class=\"line\">docker.vpclub.cn/hidevopsio/hinode-java-jar                    1.0                 00de2c65d80e        2 weeks ago         761.6 MB</span><br></pre></td></tr></table></figure>\n<p>分别是0.1 和 1.0 版本。</p>\n<h2>部署 v1版本的 hello-world</h2>\n<p>现在 在 namespace 为<code>demo</code> 创建 app 为<code>hello-world</code>的<code>pod</code>， 镜像为<code>docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 获取当前的pod</span></span><br><span class=\"line\">kubectl get pod -n demo</span><br><span class=\"line\">NAME                          READY     STATUS    RESTARTS   AGE</span><br><span class=\"line\">hello-world-bbd694d8b-9pdcs   1/1       Running   0          8m</span><br><span class=\"line\">hello-world-bbd694d8b-djv2h   1/1       Running   0          8m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 当pod STATUS为 RUNNING 的时候 pod为成功</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>获取pod的详细信息</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe pod hello-world-bbd694d8b-9pdcs -n demo</span><br></pre></td></tr></table></figure>\n<p>下面是 pod <code>hello-world-bbd694d8b-9pdcs</code>的基本信息，从下面的信息可以得到我们现  demo 组下面运行的pod为镜像名称为：<a href=\"http://docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1%EF%BC%8C\" target=\"_blank\" rel=\"noopener\">docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1，</a> sha256:<code>8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Name:</span>           <span class=\"string\">hello-world-bbd694d8b-9pdcs</span></span><br><span class=\"line\"><span class=\"attr\">Namespace:</span>      <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">Node:</span>           <span class=\"string\">k8s-06.k8s.local/172.16.10.46</span></span><br><span class=\"line\"><span class=\"string\">Start</span> <span class=\"attr\">Time:</span>     <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">11</span><span class=\"string\">:47:20</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">Labels:</span>         <span class=\"string\">app=hello-world</span></span><br><span class=\"line\">                <span class=\"string\">pod-template-hash=668250846</span></span><br><span class=\"line\"><span class=\"attr\">Annotations:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Status:</span>         <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">IP:</span>             <span class=\"number\">10.244</span><span class=\"number\">.0</span><span class=\"number\">.42</span></span><br><span class=\"line\"><span class=\"string\">Controlled</span> <span class=\"attr\">By:</span>  <span class=\"string\">ReplicaSet/hello-world-bbd694d8b</span></span><br><span class=\"line\"><span class=\"attr\">Containers:</span></span><br><span class=\"line\"><span class=\"attr\">  hello-world:</span></span><br><span class=\"line\">    <span class=\"string\">Container</span> <span class=\"attr\">ID:</span>   <span class=\"attr\">docker://5e4043acbe18304bd6c3b326ed3fc044b3cb4ec6f54f2a27e7254e5782bf406a</span></span><br><span class=\"line\"><span class=\"attr\">    Image:</span>          <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</span></span><br><span class=\"line\">    <span class=\"string\">Image</span> <span class=\"attr\">ID:</span>       <span class=\"attr\">docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</span></span><br><span class=\"line\"><span class=\"attr\">    Port:</span>           <span class=\"number\">80</span><span class=\"string\">/TCP</span></span><br><span class=\"line\"><span class=\"attr\">    State:</span>          <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">      Started:</span>      <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">11</span><span class=\"string\">:47:47</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">    Ready:</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"string\">Restart</span> <span class=\"attr\">Count:</span>  <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">    Environment:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    Mounts:</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/secrets/kubernetes.io/serviceaccount</span> <span class=\"string\">from</span> <span class=\"string\">default-token-dgqj2</span> <span class=\"string\">(ro)</span></span><br><span class=\"line\"><span class=\"attr\">Conditions:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>           <span class=\"string\">Status</span></span><br><span class=\"line\">  <span class=\"string\">Initialized</span>    <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">Ready</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">PodScheduled</span>   <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"attr\">Volumes:</span></span><br><span class=\"line\"><span class=\"attr\">  default-token-dgqj2:</span></span><br><span class=\"line\"><span class=\"attr\">    Type:</span>        <span class=\"string\">Secret</span> <span class=\"string\">(a</span> <span class=\"string\">volume</span> <span class=\"string\">populated</span> <span class=\"string\">by</span> <span class=\"string\">a</span> <span class=\"string\">Secret)</span></span><br><span class=\"line\"><span class=\"attr\">    SecretName:</span>  <span class=\"string\">default-token-dgqj2</span></span><br><span class=\"line\"><span class=\"attr\">    Optional:</span>    <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"string\">QoS</span> <span class=\"attr\">Class:</span>       <span class=\"string\">BestEffort</span></span><br><span class=\"line\"><span class=\"attr\">Node-Selectors:</span>  <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Tolerations:</span>     <span class=\"string\">node.kubernetes.io/not-ready:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\">                 <span class=\"string\">node.kubernetes.io/unreachable:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\"><span class=\"attr\">Events:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>    <span class=\"string\">Reason</span>                 <span class=\"string\">Age</span>   <span class=\"string\">From</span>                       <span class=\"string\">Message</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span><span class=\"meta\">---</span>    <span class=\"bullet\">------</span>                 <span class=\"bullet\">----</span>  <span class=\"bullet\">----</span>                       <span class=\"bullet\">-------</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Scheduled</span>              <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">default-scheduler</span>          <span class=\"string\">Successfully</span> <span class=\"string\">assigned</span> <span class=\"string\">hello-world-bbd694d8b-9pdcs</span> <span class=\"string\">to</span> <span class=\"string\">k8s-06.k8s.local</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">SuccessfulMountVolume</span>  <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">MountVolume.SetUp</span> <span class=\"string\">succeeded</span> <span class=\"string\">for</span> <span class=\"string\">volume</span> <span class=\"string\">\"default-token-dgqj2\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulling</span>                <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">pulling</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulled</span>                 <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Successfully</span> <span class=\"string\">pulled</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Created</span>                <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Created</span> <span class=\"string\">container</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Started</span>                <span class=\"number\">14</span><span class=\"string\">m</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Started</span> <span class=\"string\">container</span></span><br></pre></td></tr></table></figure>\n<h2>部署v2版本的hello-world</h2>\n<p>方法如上：</p>\n<p>获取v2版本的详细信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">kubectl get pod -n demo</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                           READY     STATUS    RESTARTS   AGE</span><br><span class=\"line\">hello-world-75d9cb465d-79vl8   1/1       Running   0          2m</span><br><span class=\"line\">hello-world-75d9cb465d-rbv2g   1/1       Running   0          2m</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">#获取pod的详细信息</span></span></span><br><span class=\"line\">kubectl describe pod hello-world-75d9cb465d-79vl8 -n demo</span><br><span class=\"line\">该pod的版本为 docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0</span><br><span class=\"line\">sha256 ：c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166</span><br></pre></td></tr></table></figure>\n<p>如下：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Name:</span>           <span class=\"string\">hello-world-75d9cb465d-79vl8</span></span><br><span class=\"line\"><span class=\"attr\">Namespace:</span>      <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">Node:</span>           <span class=\"string\">k8s-04.k8s.local/172.16.10.44</span></span><br><span class=\"line\"><span class=\"string\">Start</span> <span class=\"attr\">Time:</span>     <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">12</span><span class=\"string\">:57:52</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">Labels:</span>         <span class=\"string\">app=hello-world</span></span><br><span class=\"line\">                <span class=\"string\">pod-template-hash=3185760218</span></span><br><span class=\"line\"><span class=\"attr\">Annotations:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Status:</span>         <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">IP:</span>             <span class=\"number\">10.244</span><span class=\"number\">.2</span><span class=\"number\">.43</span></span><br><span class=\"line\"><span class=\"string\">Controlled</span> <span class=\"attr\">By:</span>  <span class=\"string\">ReplicaSet/hello-world-75d9cb465d</span></span><br><span class=\"line\"><span class=\"attr\">Containers:</span></span><br><span class=\"line\"><span class=\"attr\">  hello-world:</span></span><br><span class=\"line\">    <span class=\"string\">Container</span> <span class=\"attr\">ID:</span>   <span class=\"attr\">docker://4a115dff91073e151c41e6a3b5fd4a6e514afb8853accc76b0678a669af81c65</span></span><br><span class=\"line\"><span class=\"attr\">    Image:</span>          <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0</span></span><br><span class=\"line\">    <span class=\"string\">Image</span> <span class=\"attr\">ID:</span>       <span class=\"attr\">docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:c940617d09f231af1e902ad18315a8435b0220aef251fd7cab323bbca34e2166</span></span><br><span class=\"line\"><span class=\"attr\">    Port:</span>           <span class=\"number\">80</span><span class=\"string\">/TCP</span></span><br><span class=\"line\"><span class=\"attr\">    State:</span>          <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">      Started:</span>      <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">13</span><span class=\"string\">:00:21</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">    Ready:</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"string\">Restart</span> <span class=\"attr\">Count:</span>  <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">    Environment:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    Mounts:</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/secrets/kubernetes.io/serviceaccount</span> <span class=\"string\">from</span> <span class=\"string\">default-token-dgqj2</span> <span class=\"string\">(ro)</span></span><br><span class=\"line\"><span class=\"attr\">Conditions:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>           <span class=\"string\">Status</span></span><br><span class=\"line\">  <span class=\"string\">Initialized</span>    <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">Ready</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">PodScheduled</span>   <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"attr\">Volumes:</span></span><br><span class=\"line\"><span class=\"attr\">  default-token-dgqj2:</span></span><br><span class=\"line\"><span class=\"attr\">    Type:</span>        <span class=\"string\">Secret</span> <span class=\"string\">(a</span> <span class=\"string\">volume</span> <span class=\"string\">populated</span> <span class=\"string\">by</span> <span class=\"string\">a</span> <span class=\"string\">Secret)</span></span><br><span class=\"line\"><span class=\"attr\">    SecretName:</span>  <span class=\"string\">default-token-dgqj2</span></span><br><span class=\"line\"><span class=\"attr\">    Optional:</span>    <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"string\">QoS</span> <span class=\"attr\">Class:</span>       <span class=\"string\">BestEffort</span></span><br><span class=\"line\"><span class=\"attr\">Node-Selectors:</span>  <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Tolerations:</span>     <span class=\"string\">node.kubernetes.io/not-ready:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\">                 <span class=\"string\">node.kubernetes.io/unreachable:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\"><span class=\"attr\">Events:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>    <span class=\"string\">Reason</span>                 <span class=\"string\">Age</span>   <span class=\"string\">From</span>                       <span class=\"string\">Message</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span><span class=\"meta\">---</span>    <span class=\"bullet\">------</span>                 <span class=\"bullet\">----</span>  <span class=\"bullet\">----</span>                       <span class=\"bullet\">-------</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Scheduled</span>              <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">default-scheduler</span>          <span class=\"string\">Successfully</span> <span class=\"string\">assigned</span> <span class=\"string\">hello-world-75d9cb465d-79vl8</span> <span class=\"string\">to</span> <span class=\"string\">k8s-04.k8s.local</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">SuccessfulMountVolume</span>  <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">MountVolume.SetUp</span> <span class=\"string\">succeeded</span> <span class=\"string\">for</span> <span class=\"string\">volume</span> <span class=\"string\">\"default-token-dgqj2\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulling</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">pulling</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulled</span>                 <span class=\"number\">15</span><span class=\"string\">s</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">Successfully</span> <span class=\"string\">pulled</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:1.0\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Created</span>                <span class=\"number\">13</span><span class=\"string\">s</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">Created</span> <span class=\"string\">container</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Started</span>                <span class=\"number\">12</span><span class=\"string\">s</span>   <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-04.k8s.local</span>  <span class=\"string\">Started</span> <span class=\"string\">container</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>由详细信息可以看出该pod已经为最新的pod</li>\n</ul>\n<p>现在我们需要回退到0.1版本 镜像那么我们怎么处理呢？</p>\n<h3>检查部署的部署历史记录</h3>\n<p>首先，检查此部署的修订版：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout history deployment/hello-world -n demo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># REVISION 为 deployment/hello-world 所有版本。</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># CHANGE-CAUSE 为版本的注释</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">deployments \"hello-world\"</span><br><span class=\"line\">REVISION  CHANGE-CAUSE</span><br><span class=\"line\">1         &lt;none&gt;</span><br><span class=\"line\">2         &lt;none&gt;</span><br><span class=\"line\">3         &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">如果查看到的结果为None，则需要在创建和更新deployment时加上 --record参数.</span><br></pre></td></tr></table></figure>\n<p>修改注释</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl annotate deployment/hello-world kubernetes.io/change-cause=\"image 1.0\" -n demo --revision=3</span><br></pre></td></tr></table></figure>\n<p>要进一步查看每个修订的详细信息，请运行：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout history deployment/hello-world -n demo --revision=2</span><br></pre></td></tr></table></figure>\n<h2>回滚到以前的版本</h2>\n<p>现在您已决定撤消当前的卷展栏并回滚到以前的版本：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout undo deployment/hello-world -n demo</span><br></pre></td></tr></table></figure>\n<p>执行成功后pod会重新启动</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pod -n demo</span><br><span class=\"line\">NAME                           READY     STATUS              RESTARTS   AGE</span><br><span class=\"line\">hello-world-75d9cb465d-rbv2g   1/1       Running             0          21m</span><br><span class=\"line\">hello-world-bbd694d8b-gfh6x    1/1       Running             0          19s</span><br><span class=\"line\">hello-world-bbd694d8b-lvw88    0/1       ContainerCreating   0          18s</span><br></pre></td></tr></table></figure>\n<p>获取pod的相信信息, 由下面的例子我们可以看出镜像已经回退到上一个版本的 <code>docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</code> sha256 : <code>8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Name:</span>           <span class=\"string\">hello-world-bbd694d8b-gfh6x</span></span><br><span class=\"line\"><span class=\"attr\">Namespace:</span>      <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">Node:</span>           <span class=\"string\">k8s-06.k8s.local/172.16.10.46</span></span><br><span class=\"line\"><span class=\"string\">Start</span> <span class=\"attr\">Time:</span>     <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">13</span><span class=\"string\">:19:30</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">Labels:</span>         <span class=\"string\">app=hello-world</span></span><br><span class=\"line\">                <span class=\"string\">pod-template-hash=668250846</span></span><br><span class=\"line\"><span class=\"attr\">Annotations:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Status:</span>         <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">IP:</span>             <span class=\"number\">10.244</span><span class=\"number\">.0</span><span class=\"number\">.43</span></span><br><span class=\"line\"><span class=\"string\">Controlled</span> <span class=\"attr\">By:</span>  <span class=\"string\">ReplicaSet/hello-world-bbd694d8b</span></span><br><span class=\"line\"><span class=\"attr\">Containers:</span></span><br><span class=\"line\"><span class=\"attr\">  hello-world:</span></span><br><span class=\"line\">    <span class=\"string\">Container</span> <span class=\"attr\">ID:</span>   <span class=\"attr\">docker://b88bcf11ef2c5439511f457baf29c0724d19dca1db7dbb560f7d13a475e1cf1d</span></span><br><span class=\"line\"><span class=\"attr\">    Image:</span>          <span class=\"string\">docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1</span></span><br><span class=\"line\">    <span class=\"string\">Image</span> <span class=\"attr\">ID:</span>       <span class=\"attr\">docker-pullable://docker.vpclub.cn/hidevopsio/hinode-java-jar@sha256:8907956124918ae37b6e53fa0c66c7be77e904785ba78f6154303d2b655709ab</span></span><br><span class=\"line\"><span class=\"attr\">    Port:</span>           <span class=\"number\">80</span><span class=\"string\">/TCP</span></span><br><span class=\"line\"><span class=\"attr\">    State:</span>          <span class=\"string\">Running</span></span><br><span class=\"line\"><span class=\"attr\">      Started:</span>      <span class=\"string\">Wed,</span> <span class=\"number\">31</span> <span class=\"string\">Oct</span> <span class=\"number\">2018</span> <span class=\"number\">13</span><span class=\"string\">:19:48</span> <span class=\"string\">+0800</span></span><br><span class=\"line\"><span class=\"attr\">    Ready:</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"string\">Restart</span> <span class=\"attr\">Count:</span>  <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">    Environment:</span>    <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">    Mounts:</span></span><br><span class=\"line\">      <span class=\"string\">/var/run/secrets/kubernetes.io/serviceaccount</span> <span class=\"string\">from</span> <span class=\"string\">default-token-dgqj2</span> <span class=\"string\">(ro)</span></span><br><span class=\"line\"><span class=\"attr\">Conditions:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>           <span class=\"string\">Status</span></span><br><span class=\"line\">  <span class=\"string\">Initialized</span>    <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">Ready</span>          <span class=\"literal\">True</span></span><br><span class=\"line\">  <span class=\"string\">PodScheduled</span>   <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"attr\">Volumes:</span></span><br><span class=\"line\"><span class=\"attr\">  default-token-dgqj2:</span></span><br><span class=\"line\"><span class=\"attr\">    Type:</span>        <span class=\"string\">Secret</span> <span class=\"string\">(a</span> <span class=\"string\">volume</span> <span class=\"string\">populated</span> <span class=\"string\">by</span> <span class=\"string\">a</span> <span class=\"string\">Secret)</span></span><br><span class=\"line\"><span class=\"attr\">    SecretName:</span>  <span class=\"string\">default-token-dgqj2</span></span><br><span class=\"line\"><span class=\"attr\">    Optional:</span>    <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"string\">QoS</span> <span class=\"attr\">Class:</span>       <span class=\"string\">BestEffort</span></span><br><span class=\"line\"><span class=\"attr\">Node-Selectors:</span>  <span class=\"string\">&lt;none&gt;</span></span><br><span class=\"line\"><span class=\"attr\">Tolerations:</span>     <span class=\"string\">node.kubernetes.io/not-ready:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\">                 <span class=\"string\">node.kubernetes.io/unreachable:NoExecute</span> <span class=\"string\">for</span> <span class=\"number\">300</span><span class=\"string\">s</span></span><br><span class=\"line\"><span class=\"attr\">Events:</span></span><br><span class=\"line\">  <span class=\"string\">Type</span>    <span class=\"string\">Reason</span>                 <span class=\"string\">Age</span>   <span class=\"string\">From</span>                       <span class=\"string\">Message</span></span><br><span class=\"line\"><span class=\"bullet\">  -</span><span class=\"meta\">---</span>    <span class=\"bullet\">------</span>                 <span class=\"bullet\">----</span>  <span class=\"bullet\">----</span>                       <span class=\"bullet\">-------</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Scheduled</span>              <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">default-scheduler</span>          <span class=\"string\">Successfully</span> <span class=\"string\">assigned</span> <span class=\"string\">hello-world-bbd694d8b-gfh6x</span> <span class=\"string\">to</span> <span class=\"string\">k8s-06.k8s.local</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">SuccessfulMountVolume</span>  <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">MountVolume.SetUp</span> <span class=\"string\">succeeded</span> <span class=\"string\">for</span> <span class=\"string\">volume</span> <span class=\"string\">\"default-token-dgqj2\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulling</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">pulling</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Pulled</span>                 <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Successfully</span> <span class=\"string\">pulled</span> <span class=\"string\">image</span> <span class=\"string\">\"docker.vpclub.cn/hidevopsio/hinode-java-jar:0.1\"</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Created</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Created</span> <span class=\"string\">container</span></span><br><span class=\"line\">  <span class=\"string\">Normal</span>  <span class=\"string\">Started</span>                <span class=\"number\">2</span><span class=\"string\">m</span>    <span class=\"string\">kubelet,</span> <span class=\"string\">k8s-06.k8s.local</span>  <span class=\"string\">Started</span> <span class=\"string\">container</span></span><br></pre></td></tr></table></figure>\n<p>或者，您可以通过在–to-revision以下位置指定回滚到特定修订：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout undo deployment/hello-world -n demo --to-revision=2</span><br></pre></td></tr></table></figure>\n<h3>暂停和恢复部署</h3>\n<p>刚刚创建的部署, 使用该命令暂停：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout pause deployment\\hello-world -n demo</span><br></pre></td></tr></table></figure>\n<p>暂停之前部署的初始状态将继续其功能，但只要部署暂停，部署的新更新将不会产生任何影响。</p>\n<p>最后，恢复部署并观察一个新的ReplicaSet，提供所有新的更新：</p>\n<pre><code class=\"language-shell\">kubectl rollout resume deployment/helo-world -n demo</code></pre>\n"},{"layout":"deployment","title":"hiadmin","catalog":true,"date":"2018-11-12T02:55:46.000Z","subtitle":"hiadmin 部署手册","header-img":"7vLMRNQ.jpg","_content":"\n# 部署 hiadmin\n\nhiadmin该服务主要负责启动pipeline，任务调度， \b针对k8s 资源`crd`进行控制， 和部署流程的管控。\n\n1. 创建hiadmin的 deployment\n    因为需要在容器里面使用docker，则该项目需要挂载 /var/lib/docker ， /var/run/docker.sock\n    镜像上传到 docker.vpclub.cn\n    ```yaml\n    apiVersion: extensions/v1beta1\n    kind: Deployment\n    metadata:\n      annotations:\n      labels:\n        app: hiadmin\n        cluster: hidevopsio\n      name: hiadmin\n      namespace: hidevopsio\n    spec:\n      replicas: 1\n      selector:\n        matchLabels:\n        app: hiadmin\n        cluster: hidevopsio\n      strategy:\n        rollingUpdate:\n        maxSurge: 1\n        maxUnavailable: 1\n        type: RollingUpdate\n      template:\n        metadata:\n        creationTimestamp: null\n        labels:\n          app: hiadmin\n          cluster: hidevopsio\n        spec:\n        nodeName: paasm1\n        containers:\n        - env:\n          - name: TZ\n            value: Asia/Shanghai\n          - name: APP_PROFILES_ACTIVE\n            value: dev\n          - name: SCM_URL\n            value: https://gitlab.vpclub.cn\n          image: docker.vpclub.cn/hidevopsio/hiadmin:v5\n          imagePullPolicy: Always\n          name: hiadmin\n          ports:\n          - containerPort: 7575\n            protocol: TCP\n          - containerPort: 8080\n            protocol: TCP\n          resources: {}\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n          volumeMounts:\n          - mountPath: /var/lib/docker\n            name: volume1\n          - mountPath: /var/run/docker.sock\n            name: volume2\n        dnsPolicy: ClusterFirst\n        restartPolicy: Always\n        schedulerName: default-scheduler\n        securityContext: {}\n        terminationGracePeriodSeconds: 30\n        volumes:\n        - hostPath:\n            path: /var/lib/docker\n            type: \"\"\n          name: volume1\n        - hostPath:\n            path: /var/run/docker.sock\n            type: \"\"\n          name: volume2\n    ```\n\n2. 创建hiadmin的service\n    hiadmin 开启需要开启8080 和 7575 端口\n    ```yaml\n    apiVersion: v1\n    kind: Service\n    metadata:\n      name: hiadmin\n      namespace: hidevopsio\n    spec:\n      ports:\n      - name: 8080-tcp\n        port: 8080\n        protocol: TCP\n        targetPort: 8080\n      - name: 7575-tcp\n        port: 7575\n        protocol: TCP\n        targetPort: 7575\n      selector:\n        app: hiadmin\n      sessionAffinity: None\n      type: ClusterIP\n    status:\n      loadBalancer: {}\n    ```\n\n3. 配置nginx通过网关可以访问服务\n    hiadmin 需要websocket所以nginx网关需要添加 `proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Origin \"\"`.\n\n   ```yaml\n   server {\n    listen      80;\n    server_name nginx-gateway.app.vpclub.io;\n\n    access_log  /dev/stdout  main;\n    error_log   /dev/stderr;\n    client_max_body_size 200m;\n    location = /favicon.ico {\n        return 204;\n        access_log     off;\n        log_not_found  off;\n    }\n\n    # limit_req zone=REQ burst=2;\n    # limit_conn CONN 10;\n    location /demo/hiadmin/ {\n        client_max_body_size 200m;\n        proxy_pass http://hiadmin-demo.app.vpclub.io/; \n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n\n    location /demo/websocket/ {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Origin \"\";\n        client_max_body_size 200m;\n        proxy_pass http://hiadmin-demo.app.vpclub.io/;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n        }\n\n    }\n   ```\n\n# 部署hinode\n\nhinode的作用主要是在于针对代码的编译，比如java的 `mvn clean install`, nodejs的`npm install && npm run build:dev`等等操作。另外还有制作镜像，推镜像等过程。\n\nimage： `docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22`\n\nhinode 是由`hiadmin`发送指令进行操作的\n","source":"_posts/hiadmin.md","raw":"---\nlayout: deployment\ntitle: hiadmin\ncatalog: true\ndate: 2018-11-12 10:55:46\ntags: \n- k8s\n- deployment\n- devopsio\nsubtitle: \"hiadmin 部署手册\"\nheader-img: \"7vLMRNQ.jpg\"\n---\n\n# 部署 hiadmin\n\nhiadmin该服务主要负责启动pipeline，任务调度， \b针对k8s 资源`crd`进行控制， 和部署流程的管控。\n\n1. 创建hiadmin的 deployment\n    因为需要在容器里面使用docker，则该项目需要挂载 /var/lib/docker ， /var/run/docker.sock\n    镜像上传到 docker.vpclub.cn\n    ```yaml\n    apiVersion: extensions/v1beta1\n    kind: Deployment\n    metadata:\n      annotations:\n      labels:\n        app: hiadmin\n        cluster: hidevopsio\n      name: hiadmin\n      namespace: hidevopsio\n    spec:\n      replicas: 1\n      selector:\n        matchLabels:\n        app: hiadmin\n        cluster: hidevopsio\n      strategy:\n        rollingUpdate:\n        maxSurge: 1\n        maxUnavailable: 1\n        type: RollingUpdate\n      template:\n        metadata:\n        creationTimestamp: null\n        labels:\n          app: hiadmin\n          cluster: hidevopsio\n        spec:\n        nodeName: paasm1\n        containers:\n        - env:\n          - name: TZ\n            value: Asia/Shanghai\n          - name: APP_PROFILES_ACTIVE\n            value: dev\n          - name: SCM_URL\n            value: https://gitlab.vpclub.cn\n          image: docker.vpclub.cn/hidevopsio/hiadmin:v5\n          imagePullPolicy: Always\n          name: hiadmin\n          ports:\n          - containerPort: 7575\n            protocol: TCP\n          - containerPort: 8080\n            protocol: TCP\n          resources: {}\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n          volumeMounts:\n          - mountPath: /var/lib/docker\n            name: volume1\n          - mountPath: /var/run/docker.sock\n            name: volume2\n        dnsPolicy: ClusterFirst\n        restartPolicy: Always\n        schedulerName: default-scheduler\n        securityContext: {}\n        terminationGracePeriodSeconds: 30\n        volumes:\n        - hostPath:\n            path: /var/lib/docker\n            type: \"\"\n          name: volume1\n        - hostPath:\n            path: /var/run/docker.sock\n            type: \"\"\n          name: volume2\n    ```\n\n2. 创建hiadmin的service\n    hiadmin 开启需要开启8080 和 7575 端口\n    ```yaml\n    apiVersion: v1\n    kind: Service\n    metadata:\n      name: hiadmin\n      namespace: hidevopsio\n    spec:\n      ports:\n      - name: 8080-tcp\n        port: 8080\n        protocol: TCP\n        targetPort: 8080\n      - name: 7575-tcp\n        port: 7575\n        protocol: TCP\n        targetPort: 7575\n      selector:\n        app: hiadmin\n      sessionAffinity: None\n      type: ClusterIP\n    status:\n      loadBalancer: {}\n    ```\n\n3. 配置nginx通过网关可以访问服务\n    hiadmin 需要websocket所以nginx网关需要添加 `proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Origin \"\"`.\n\n   ```yaml\n   server {\n    listen      80;\n    server_name nginx-gateway.app.vpclub.io;\n\n    access_log  /dev/stdout  main;\n    error_log   /dev/stderr;\n    client_max_body_size 200m;\n    location = /favicon.ico {\n        return 204;\n        access_log     off;\n        log_not_found  off;\n    }\n\n    # limit_req zone=REQ burst=2;\n    # limit_conn CONN 10;\n    location /demo/hiadmin/ {\n        client_max_body_size 200m;\n        proxy_pass http://hiadmin-demo.app.vpclub.io/; \n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n\n    location /demo/websocket/ {\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Origin \"\";\n        client_max_body_size 200m;\n        proxy_pass http://hiadmin-demo.app.vpclub.io/;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n        }\n\n    }\n   ```\n\n# 部署hinode\n\nhinode的作用主要是在于针对代码的编译，比如java的 `mvn clean install`, nodejs的`npm install && npm run build:dev`等等操作。另外还有制作镜像，推镜像等过程。\n\nimage： `docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22`\n\nhinode 是由`hiadmin`发送指令进行操作的\n","slug":"hiadmin","published":1,"updated":"2018-11-13T09:21:39.702Z","comments":1,"photos":[],"link":"","_id":"cjoofzuvd0007ttjrel1qonrp","content":"<h1><span id=\"部署-hiadmin\">部署 hiadmin</span></h1>\n<p>hiadmin该服务主要负责启动pipeline，任务调度， \b针对k8s 资源<code>crd</code>进行控制， 和部署流程的管控。</p>\n<ol>\n<li>\n<p>创建hiadmin的 deployment<br>\n因为需要在容器里面使用docker，则该项目需要挂载 /var/lib/docker ， /var/run/docker.sock<br>\n镜像上传到 <a href=\"http://docker.vpclub.cn\" target=\"_blank\" rel=\"noopener\">docker.vpclub.cn</a></p>\n <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">    cluster:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">    cluster:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">  strategy:</span></span><br><span class=\"line\"><span class=\"attr\">    rollingUpdate:</span></span><br><span class=\"line\"><span class=\"attr\">    maxSurge:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">    maxUnavailable:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">RollingUpdate</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">    creationTimestamp:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"attr\">    labels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">      cluster:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">    nodeName:</span> <span class=\"string\">paasm1</span></span><br><span class=\"line\"><span class=\"attr\">    containers:</span></span><br><span class=\"line\"><span class=\"attr\">    - env:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">TZ</span></span><br><span class=\"line\"><span class=\"attr\">        value:</span> <span class=\"string\">Asia/Shanghai</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">APP_PROFILES_ACTIVE</span></span><br><span class=\"line\"><span class=\"attr\">        value:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">SCM_URL</span></span><br><span class=\"line\"><span class=\"attr\">        value:</span> <span class=\"attr\">https://gitlab.vpclub.cn</span></span><br><span class=\"line\"><span class=\"attr\">      image:</span> <span class=\"string\">docker.vpclub.cn/hidevopsio/hiadmin:v5</span></span><br><span class=\"line\"><span class=\"attr\">      imagePullPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">      ports:</span></span><br><span class=\"line\"><span class=\"attr\">      - containerPort:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">        protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">      - containerPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">        protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">      resources:</span> <span class=\"string\">&#123;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">      terminationMessagePath:</span> <span class=\"string\">/dev/termination-log</span></span><br><span class=\"line\"><span class=\"attr\">      terminationMessagePolicy:</span> <span class=\"string\">File</span></span><br><span class=\"line\"><span class=\"attr\">      volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">      - mountPath:</span> <span class=\"string\">/var/lib/docker</span></span><br><span class=\"line\"><span class=\"attr\">        name:</span> <span class=\"string\">volume1</span></span><br><span class=\"line\"><span class=\"attr\">      - mountPath:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"attr\">        name:</span> <span class=\"string\">volume2</span></span><br><span class=\"line\"><span class=\"attr\">    dnsPolicy:</span> <span class=\"string\">ClusterFirst</span></span><br><span class=\"line\"><span class=\"attr\">    restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">    schedulerName:</span> <span class=\"string\">default-scheduler</span></span><br><span class=\"line\"><span class=\"attr\">    securityContext:</span> <span class=\"string\">&#123;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">    terminationGracePeriodSeconds:</span> <span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"attr\">    volumes:</span></span><br><span class=\"line\"><span class=\"attr\">    - hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">        path:</span> <span class=\"string\">/var/lib/docker</span></span><br><span class=\"line\"><span class=\"attr\">        type:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">volume1</span></span><br><span class=\"line\"><span class=\"attr\">    - hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">        path:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"attr\">        type:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">volume2</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>创建hiadmin的service<br>\nhiadmin 开启需要开启8080 和 7575 端口</p>\n <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"number\">8080</span><span class=\"bullet\">-tcp</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"number\">7575</span><span class=\"bullet\">-tcp</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">  sessionAffinity:</span> <span class=\"string\">None</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">ClusterIP</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  loadBalancer:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>配置nginx通过网关可以访问服务<br>\nhiadmin 需要websocket所以nginx网关需要添加 <code>proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &quot;upgrade&quot;; proxy_set_header Origin &quot;&quot;</code>.</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">server</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"> <span class=\"string\">listen</span>      <span class=\"number\">80</span><span class=\"string\">;</span></span><br><span class=\"line\"> <span class=\"string\">server_name</span> <span class=\"string\">nginx-gateway.app.vpclub.io;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">access_log</span>  <span class=\"string\">/dev/stdout</span>  <span class=\"string\">main;</span></span><br><span class=\"line\"> <span class=\"string\">error_log</span>   <span class=\"string\">/dev/stderr;</span></span><br><span class=\"line\"> <span class=\"string\">client_max_body_size</span> <span class=\"number\">200</span><span class=\"string\">m;</span></span><br><span class=\"line\"> <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/favicon.ico</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">     <span class=\"string\">return</span> <span class=\"number\">204</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">access_log</span>     <span class=\"string\">off;</span></span><br><span class=\"line\">     <span class=\"string\">log_not_found</span>  <span class=\"string\">off;</span></span><br><span class=\"line\"> <span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># limit_req zone=REQ burst=2;</span></span><br><span class=\"line\"> <span class=\"comment\"># limit_conn CONN 10;</span></span><br><span class=\"line\"> <span class=\"string\">location</span> <span class=\"string\">/demo/hiadmin/</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">     <span class=\"string\">client_max_body_size</span> <span class=\"number\">200</span><span class=\"string\">m;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_pass</span> <span class=\"attr\">http://hiadmin-demo.app.vpclub.io/;</span> </span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Real-IP</span> <span class=\"string\">$remote_addr;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Forwarded-For</span> <span class=\"string\">$proxy_add_x_forwarded_for;</span></span><br><span class=\"line\"> <span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">location</span> <span class=\"string\">/demo/websocket/</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_http_version</span> <span class=\"number\">1.1</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">Upgrade</span> <span class=\"string\">$http_upgrade;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">Connection</span> <span class=\"string\">\"upgrade\"</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">Origin</span> <span class=\"string\">\"\"</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">client_max_body_size</span> <span class=\"number\">200</span><span class=\"string\">m;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_pass</span> <span class=\"attr\">http://hiadmin-demo.app.vpclub.io/;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Real-IP</span> <span class=\"string\">$remote_addr;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Forwarded-For</span> <span class=\"string\">$proxy_add_x_forwarded_for;</span></span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h1><span id=\"部署hinode\">部署hinode</span></h1>\n<p>hinode的作用主要是在于针对代码的编译，比如java的 <code>mvn clean install</code>, nodejs的<code>npm install &amp;&amp; npm run build:dev</code>等等操作。另外还有制作镜像，推镜像等过程。</p>\n<p>image： <code>docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22</code></p>\n<p>hinode 是由<code>hiadmin</code>发送指令进行操作的</p>\n","site":{"data":{}},"excerpt":"","more":"<h1>部署 hiadmin</h1>\n<p>hiadmin该服务主要负责启动pipeline，任务调度， \b针对k8s 资源<code>crd</code>进行控制， 和部署流程的管控。</p>\n<ol>\n<li>\n<p>创建hiadmin的 deployment<br>\n因为需要在容器里面使用docker，则该项目需要挂载 /var/lib/docker ， /var/run/docker.sock<br>\n镜像上传到 <a href=\"http://docker.vpclub.cn\" target=\"_blank\" rel=\"noopener\">docker.vpclub.cn</a></p>\n <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">extensions/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">    cluster:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">    cluster:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">  strategy:</span></span><br><span class=\"line\"><span class=\"attr\">    rollingUpdate:</span></span><br><span class=\"line\"><span class=\"attr\">    maxSurge:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">    maxUnavailable:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">RollingUpdate</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">    creationTimestamp:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"attr\">    labels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">      cluster:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">    nodeName:</span> <span class=\"string\">paasm1</span></span><br><span class=\"line\"><span class=\"attr\">    containers:</span></span><br><span class=\"line\"><span class=\"attr\">    - env:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">TZ</span></span><br><span class=\"line\"><span class=\"attr\">        value:</span> <span class=\"string\">Asia/Shanghai</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">APP_PROFILES_ACTIVE</span></span><br><span class=\"line\"><span class=\"attr\">        value:</span> <span class=\"string\">dev</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">SCM_URL</span></span><br><span class=\"line\"><span class=\"attr\">        value:</span> <span class=\"attr\">https://gitlab.vpclub.cn</span></span><br><span class=\"line\"><span class=\"attr\">      image:</span> <span class=\"string\">docker.vpclub.cn/hidevopsio/hiadmin:v5</span></span><br><span class=\"line\"><span class=\"attr\">      imagePullPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">      ports:</span></span><br><span class=\"line\"><span class=\"attr\">      - containerPort:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">        protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">      - containerPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">        protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">      resources:</span> <span class=\"string\">&#123;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">      terminationMessagePath:</span> <span class=\"string\">/dev/termination-log</span></span><br><span class=\"line\"><span class=\"attr\">      terminationMessagePolicy:</span> <span class=\"string\">File</span></span><br><span class=\"line\"><span class=\"attr\">      volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">      - mountPath:</span> <span class=\"string\">/var/lib/docker</span></span><br><span class=\"line\"><span class=\"attr\">        name:</span> <span class=\"string\">volume1</span></span><br><span class=\"line\"><span class=\"attr\">      - mountPath:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"attr\">        name:</span> <span class=\"string\">volume2</span></span><br><span class=\"line\"><span class=\"attr\">    dnsPolicy:</span> <span class=\"string\">ClusterFirst</span></span><br><span class=\"line\"><span class=\"attr\">    restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\"><span class=\"attr\">    schedulerName:</span> <span class=\"string\">default-scheduler</span></span><br><span class=\"line\"><span class=\"attr\">    securityContext:</span> <span class=\"string\">&#123;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">    terminationGracePeriodSeconds:</span> <span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"attr\">    volumes:</span></span><br><span class=\"line\"><span class=\"attr\">    - hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">        path:</span> <span class=\"string\">/var/lib/docker</span></span><br><span class=\"line\"><span class=\"attr\">        type:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">volume1</span></span><br><span class=\"line\"><span class=\"attr\">    - hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">        path:</span> <span class=\"string\">/var/run/docker.sock</span></span><br><span class=\"line\"><span class=\"attr\">        type:</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">volume2</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>创建hiadmin的service<br>\nhiadmin 开启需要开启8080 和 7575 端口</p>\n <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">hidevopsio</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"number\">8080</span><span class=\"bullet\">-tcp</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">8080</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"number\">7575</span><span class=\"bullet\">-tcp</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">7575</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">hiadmin</span></span><br><span class=\"line\"><span class=\"attr\">  sessionAffinity:</span> <span class=\"string\">None</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">ClusterIP</span></span><br><span class=\"line\"><span class=\"attr\">status:</span></span><br><span class=\"line\"><span class=\"attr\">  loadBalancer:</span> <span class=\"string\">&#123;&#125;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>配置nginx通过网关可以访问服务<br>\nhiadmin 需要websocket所以nginx网关需要添加 <code>proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &quot;upgrade&quot;; proxy_set_header Origin &quot;&quot;</code>.</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">server</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"> <span class=\"string\">listen</span>      <span class=\"number\">80</span><span class=\"string\">;</span></span><br><span class=\"line\"> <span class=\"string\">server_name</span> <span class=\"string\">nginx-gateway.app.vpclub.io;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">access_log</span>  <span class=\"string\">/dev/stdout</span>  <span class=\"string\">main;</span></span><br><span class=\"line\"> <span class=\"string\">error_log</span>   <span class=\"string\">/dev/stderr;</span></span><br><span class=\"line\"> <span class=\"string\">client_max_body_size</span> <span class=\"number\">200</span><span class=\"string\">m;</span></span><br><span class=\"line\"> <span class=\"string\">location</span> <span class=\"string\">=</span> <span class=\"string\">/favicon.ico</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">     <span class=\"string\">return</span> <span class=\"number\">204</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">access_log</span>     <span class=\"string\">off;</span></span><br><span class=\"line\">     <span class=\"string\">log_not_found</span>  <span class=\"string\">off;</span></span><br><span class=\"line\"> <span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># limit_req zone=REQ burst=2;</span></span><br><span class=\"line\"> <span class=\"comment\"># limit_conn CONN 10;</span></span><br><span class=\"line\"> <span class=\"string\">location</span> <span class=\"string\">/demo/hiadmin/</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">     <span class=\"string\">client_max_body_size</span> <span class=\"number\">200</span><span class=\"string\">m;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_pass</span> <span class=\"attr\">http://hiadmin-demo.app.vpclub.io/;</span> </span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Real-IP</span> <span class=\"string\">$remote_addr;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Forwarded-For</span> <span class=\"string\">$proxy_add_x_forwarded_for;</span></span><br><span class=\"line\"> <span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">location</span> <span class=\"string\">/demo/websocket/</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_http_version</span> <span class=\"number\">1.1</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">Upgrade</span> <span class=\"string\">$http_upgrade;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">Connection</span> <span class=\"string\">\"upgrade\"</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">Origin</span> <span class=\"string\">\"\"</span><span class=\"string\">;</span></span><br><span class=\"line\">     <span class=\"string\">client_max_body_size</span> <span class=\"number\">200</span><span class=\"string\">m;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_pass</span> <span class=\"attr\">http://hiadmin-demo.app.vpclub.io/;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Real-IP</span> <span class=\"string\">$remote_addr;</span></span><br><span class=\"line\">     <span class=\"string\">proxy_set_header</span> <span class=\"string\">X-Forwarded-For</span> <span class=\"string\">$proxy_add_x_forwarded_for;</span></span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h1>部署hinode</h1>\n<p>hinode的作用主要是在于针对代码的编译，比如java的 <code>mvn clean install</code>, nodejs的<code>npm install &amp;&amp; npm run build:dev</code>等等操作。另外还有制作镜像，推镜像等过程。</p>\n<p>image： <code>docker.vpclub.cn/hidevopsio/hinode-java-jar:1.22</code></p>\n<p>hinode 是由<code>hiadmin</code>发送指令进行操作的</p>\n"}],"PostAsset":[{"_id":"source/_posts/crd/7vLMRNQ.jpg","slug":"7vLMRNQ.jpg","post":"cjoofzuv80004ttjrphglwkv6","modified":0,"renderable":0},{"_id":"source/_posts/deployment/7vLMRNQ.jpg","slug":"7vLMRNQ.jpg","post":"cjoofzuva0005ttjr60ctc38b","modified":0,"renderable":0},{"_id":"source/_posts/hiadmin/7vLMRNQ.jpg","slug":"7vLMRNQ.jpg","post":"cjoofzuvd0007ttjrel1qonrp","modified":0,"renderable":0},{"_id":"source/_posts/python学习笔记（一）/7vLMRNQ.jpg","slug":"7vLMRNQ.jpg","post":"cjoofzuv50002ttjrgbg6o50i","modified":0,"renderable":0}],"PostCategory":[],"PostTag":[{"post_id":"cjoofzuv80004ttjrphglwkv6","tag_id":"cjoofzuvb0006ttjrksjw35sq","_id":"cjoofzuvg000attjr9sfjdl1q"},{"post_id":"cjoofzuv80004ttjrphglwkv6","tag_id":"cjoofzuve0008ttjrk2v26twi","_id":"cjoofzuvg000bttjrkebzuxs6"},{"post_id":"cjoofzuva0005ttjr60ctc38b","tag_id":"cjoofzuve0008ttjrk2v26twi","_id":"cjoofzuvh000ettjr3ansqkh7"},{"post_id":"cjoofzuva0005ttjr60ctc38b","tag_id":"cjoofzuvg000cttjrlg73g127","_id":"cjoofzuvi000fttjrci1m8ypp"},{"post_id":"cjoofzuvd0007ttjrel1qonrp","tag_id":"cjoofzuve0008ttjrk2v26twi","_id":"cjoofzuvi000ittjrcl14o0xd"},{"post_id":"cjoofzuvd0007ttjrel1qonrp","tag_id":"cjoofzuvg000cttjrlg73g127","_id":"cjoofzuvj000jttjrsbnp400v"},{"post_id":"cjoofzuvd0007ttjrel1qonrp","tag_id":"cjoofzuvi000httjrf1y7wzo4","_id":"cjoofzuvj000kttjrfavbqd7j"},{"post_id":"cjoofzuv50002ttjrgbg6o50i","tag_id":"cjoog1jvr000qttjrolgir8gf","_id":"cjoog1jvr000rttjr74qoxdku"}],"Tag":[{"name":"crd","_id":"cjoofzuvb0006ttjrksjw35sq"},{"name":"k8s","_id":"cjoofzuve0008ttjrk2v26twi"},{"name":"deployment","_id":"cjoofzuvg000cttjrlg73g127"},{"name":"devopsio","_id":"cjoofzuvi000httjrf1y7wzo4"},{"name":"pyhton","_id":"cjoog128x000mttjr15r0ju5e"},{"name":"python","_id":"cjoog17al000ottjr4nx7n0ba"},{"name":"Python","_id":"cjoog1jvr000qttjrolgir8gf"}]}}